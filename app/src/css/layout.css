/* ====================================================================
   NEBULA LAYOUT SYSTEM (FULL SCREEN - No Sidebar)
   ==================================================================== */

/* ====================================================================
   APP LOAD ANIMATION (Premium iOS 2025 blur-to-sharp reveal)
   Elements start visible but blurred, then progressively sharpen.
   ==================================================================== */
@keyframes appFadeInBlur {
    from {
        opacity: 0;
        filter: blur(8px);
        transform: translateY(12px);
    }

    to {
        opacity: 1;
        filter: blur(0);
        transform: translateY(0);
    }
}

/* App starts with blur applied, animation removes it progressively */
.app-loading .header {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) both;
}

.app-loading .stats-container {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.08s both;
}

.app-loading .output-header {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.15s both;
}

.app-loading #outputList {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.22s both;
}

.app-loading .fab-add-student {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.3s both;
}

/* Individual stat cards for extra stagger effect */
.app-loading .stat-card:nth-child(1) {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.05s both;
}

.app-loading .stat-card:nth-child(2) {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.1s both;
}

.app-loading .stat-card:nth-child(3) {
    animation: appFadeInBlur 0.6s cubic-bezier(0.32, 0.72, 0, 1) 0.15s both;
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {

    .app-loading .header,
    .app-loading .stats-container,
    .app-loading .stat-card,
    .app-loading .output-header,
    .app-loading #outputList,
    .app-loading .fab-add-student {
        animation: none;
    }
}

/* ==================================================================== */

.app-layout {
    display: grid;
    /* Sidebar removed - full width main content */
    grid-template-columns: 1fr;
    grid-template-areas: "main";
    gap: 0;
    height: 100dvh;
    padding: 0;
    background-color: var(--bg-color);
    overflow: hidden;
    position: relative;
    transition: all var(--transition-base);
}

/* Sidebar styles removed - Hub Modal handles imports now */

/* --- Main Content Area --- */
.main-content-wrapper {
    grid-area: main;
    height: 100%;
    /* Scroll moved to .main-content */
    display: flex;
    flex-direction: column;
    border-radius: 0;
    overflow: hidden;
    /* Ensure content is constrained to wrapper height */
}

.main-content {
    flex-grow: 1;
    min-height: 0;
    /* Scroll happens here now */
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;

    /* Padding-top: fixed 56px header + content spacing */
    padding: calc(56px + var(--space-5)) var(--space-8) var(--space-6);
    /* MAX-WIDTH RETIRÉ : Pleine largeur disponible */
    max-width: none;
    width: 100%;
    margin: 0;
    /* Bento Grid Interne pour le contenu */
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
}

.output-section {
    margin: 0;
    padding: 0;
    position: relative;
    /* For absolute positioned filter banner */
}

.section-title {
    font-size: var(--font-2xl);
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.sub-section-title {
    font-size: var(--font-xl);
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ====================================================================
   en-tête (header) - Effet transparence moderne
   ==================================================================== */
.header {
    flex-shrink: 0;
    /* Fixed height across all breakpoints for consistency */
    height: 56px;
    /* Transparence "légère" et effet dépoli (Frosted Glass) */
    background: rgba(var(--surface-color-rgb), 0.65);
    backdrop-filter: blur(16px) saturate(120%);
    -webkit-backdrop-filter: blur(16px) saturate(120%);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--space-4);
    /* Position absolute to allow content to scroll BEHIND it (Glassmorphism) */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    z-index: var(--z-header);
}

/* Header Logo */
.header-logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
}

.header-logo img {
    height: 36px;
    width: auto;
    object-fit: contain;
}

/* Header en mode sombre - Géré automatiquement via var(--surface-color-rgb) */

.header-center {
    display: flex;
    justify-content: center;
    flex-grow: 1;
    /* pour centrer le sélecteur de période */
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

#sidebarToggle {
    margin-left: -8px;
    /* ajuster la position */
}

#sidebarToggle i {
    transition: transform var(--transition-base);
}

.app-layout.sidebar-collapsed #sidebarToggle i {
    transform: rotate(180deg);
}

/* puce de contexte de la classe */
.header-context-chip {
    display: flex;
    align-items: center;
    gap: 12px;
    background-color: transparent;
    /* Was var(--surface-color) */
    border-radius: var(--radius-pill);
    /* Restored to pill shape given it will be visible on hover */
    padding: 8px 16px;
    /* Restored horizontal padding for pill shape balance */
    font-size: 1.1rem;
    /* Slightly reduced as requested */
    font-weight: 700;
    /* Bolder */
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
    border: 1px solid transparent;
    box-shadow: none;
    /* Removed shadow */
    position: relative;
    overflow: visible;
    /* To allow potential dropdowns or effects */
}

.header-context-chip:hover,
.header-context-chip.active {
    border-color: transparent;
    background-color: var(--surface-color);
    /* Restore background on hover */
    /* Sharp pixel-perfect shadow (matched with Theme Selector) */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
    /* Slight lift */
    color: var(--text-primary);
    /* Keep text primary on hover, simpler */
}

[data-theme="dark"] .header-context-chip:hover,
[data-theme="dark"] .header-context-chip.active {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.header-context-chip:active {
    transform: scale(0.98);
    box-shadow: none;
    background-color: rgba(0, 0, 0, 0.08);
    /* Slightly darker on press */
}

.header-context-chip .icon {
    color: var(--text-secondary);
    transition: color var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.header-context-chip:hover .icon {
    color: var(--primary-color);
}

/* Chip spécifique pour le modèle IA */
.ai-model-chip {
    background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.08), rgba(var(--primary-color-rgb), 0.15));
    border: 1px solid rgba(var(--primary-color-rgb), 0.2);
    position: relative;
    overflow: hidden;
    transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: none;
}

.ai-model-chip .icon {
    color: var(--primary-color);
}

.ai-model-chip:hover {
    background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.15), rgba(var(--primary-color-rgb), 0.25));
    border-color: var(--primary-color);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

[data-theme="dark"] .ai-model-chip:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

/* État: Génération en cours - Contour dynamique fluide (même style que textarea:focus) */
.ai-model-chip.generating {
    animation: none;
    border: 1px solid transparent !important;
    background-image: linear-gradient(var(--surface-color), var(--surface-color)),
        conic-gradient(from var(--gradient-angle),
            rgba(var(--primary-color-rgb), 0.6) 0%,
            rgba(var(--primary-color-rgb), 0.6) 18%,
            var(--glow-highlight) 23%,
            var(--glow-highlight) 27%,
            rgba(var(--primary-color-rgb), 0.6) 32%,
            rgba(var(--primary-color-rgb), 0.6) 50%,
            rgba(var(--primary-color-rgb), 0.6) 68%,
            var(--glow-highlight) 73%,
            var(--glow-highlight) 77%,
            rgba(var(--primary-color-rgb), 0.6) 82%,
            rgba(var(--primary-color-rgb), 0.6) 100%);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    animation: rotate-gradient 8s linear infinite;
    /* Metamorph shadow + Focus ring, replacing diffuse glow */
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.12),
        0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

[data-theme="dark"] .ai-model-chip.generating {
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.12),
        0 2px 8px rgba(0, 0, 0, 0.4);
}

/* Le pseudo-élément ::before n'est plus nécessaire pour l'effet fluide */
.ai-model-chip.generating::before {
    display: none;
}

/* Le pseudo-élément ::after n'est plus nécessaire pour l'effet fluide */
.ai-model-chip.generating::after {
    display: none;
}

/* État: Fallback activé - Flash orange avec glow */
/* État: Fallback activé - Flash orange avec glow et shake */
.ai-model-chip.fallback-active {
    animation: switch-shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.25));
    border-color: var(--warning-color);
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
}

.ai-model-chip.fallback-active .icon {
    color: var(--warning-color);
    transform: scale(1.1);
    /* L'icône grossit un peu */
    transition: transform var(--transition-base);
}

.ai-model-chip.fallback-active #headerAiModelName {
    color: var(--warning-hover);
    font-weight: 600;
}

@keyframes switch-shake {
    0% {
        transform: scale(1);
    }

    15% {
        transform: scale(1.05) rotate(-2deg);
    }

    30% {
        transform: scale(1.05) rotate(2deg);
    }

    45% {
        transform: scale(1.05) rotate(-2deg);
    }

    60% {
        transform: scale(1.05) rotate(1deg);
    }

    75% {
        transform: scale(1) rotate(0deg);
    }

    100% {
        transform: scale(1);
    }
}

/* Animation de changement de modèle (texte) */
.ai-model-chip .model-name-transition {
    display: inline-block;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    /* Transition "sharp" et rapide */
}

/* 1. L'ancien texte monte et disparaît */
.ai-model-chip .exit-up {
    opacity: 0;
    transform: translateY(-15px);
}

/* 2. Le nouveau texte se prépare en bas */
.ai-model-chip .enter-from-down {
    opacity: 0;
    transform: translateY(15px);
}

/* 3. Inverse: L'ancien texte descend et disparaît (pour le retour) */
.ai-model-chip .exit-down {
    opacity: 0;
    transform: translateY(15px);
}

/* 4. Inverse: Le nouveau texte se prépare en haut (pour le retour) */
.ai-model-chip .enter-from-up {
    opacity: 0;
    transform: translateY(-15px);
}

/* Badge indicateur de fallback */
.ai-model-chip .fallback-indicator {
    display: none;
    font-size: 10px;
    padding: 2px 6px;
    background: var(--gradient-warning);
    color: white;
    border-radius: var(--radius-pill);
    margin-left: 6px;
    font-weight: 600;
    animation: badge-appear 0.3s ease-out;
}

.ai-model-chip.fallback-active .fallback-indicator {
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

@keyframes badge-appear {
    from {
        opacity: 0;
        transform: scale(0.5);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Texte du modèle avec fallback indicator */
.ai-model-chip .model-text-container {
    display: flex;
    align-items: center;
}

/* Badge d'erreur dans le header - MOVED to modules/generation-status.css */

/* ====================================================================
   Pilule segmentée pour actions système (Aide, Thème, Paramètres)
   ==================================================================== */
.header-actions-pill {
    display: flex;
    align-items: center;
    background-color: transparent;
    border-radius: 0;
    padding: 0;
    gap: 8px;
    /* Increased gap slightly for better separation without the pill */
    border: none;
    transition: all var(--transition-fast);
    position: relative;
    /* Context for dropdown */
    height: 38px;
}

/* Separator between AI Dashboard and Actions */
.header-actions-pill::before {
    content: '';
    display: block;
    width: 1px;
    height: 24px;
    background-color: var(--border-color);
    opacity: 0.6;
    margin-right: 4px;
    margin-left: 4px;
}

.header-actions-pill:hover {
    border-color: transparent;
    background-color: transparent;
}

/* ====================================================================
   Nouveau système: Menu unifié + Cloud minimal
   ==================================================================== */

/* 1. Cloud Indicator Minimalist */
.cloud-sync-indicator.minimal-cloud {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    position: relative;
    border: none;
    background: transparent;
    color: var(--text-tertiary);
    /* Default state */
    transition: all var(--transition-fast);
}

.cloud-sync-indicator.minimal-cloud:hover {
    color: var(--text-primary);
    background-color: var(--surface-color);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

.cloud-sync-indicator.minimal-cloud:active {
    transform: scale(0.92);
    background-color: var(--surface-color);
    box-shadow: none;
}

[data-theme="dark"] .cloud-sync-indicator.minimal-cloud:hover {
    background-color: var(--surface-color);
    /* Ensure contrast in dark mode too */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    /* Stronger shadow in dark mode */
}

.cloud-sync-indicator.minimal-cloud i.fa-cloud,
.cloud-sync-indicator.minimal-cloud i.fa-hard-drive {
    font-size: 16px;
    /* User request: Cloud always white with dark grey outline */
    color: #ffffff;
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
    -webkit-text-stroke: 1px #374151;
    /* Gray-700 */
    transition: all var(--transition-fast);
}

/* Status dot instead of complex badge */
.cloud-sync-indicator.minimal-cloud .cloud-status-badge {
    position: absolute;
    bottom: 6px;
    right: 6px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: transparent;
    /* Default hidden/transparent */
    border: 2px solid var(--bg-secondary);
    /* Border to cut circle */
    padding: 0;
    pointer-events: none;
}

/* Override existing badge content (we want dots only) */
.cloud-sync-indicator.minimal-cloud .cloud-status-badge i {
    display: none;
}

/* Status colors map to the dot */
/* État connecté - Nuage BLANC (fixe), point VERT */
.cloud-sync-indicator.connected {
    color: inherit;
    /* Icon handles its own color */
}

[data-theme="dark"] .cloud-sync-indicator.connected {
    color: inherit;
}

.cloud-sync-indicator.connected:hover {
    background-color: var(--surface-color);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .cloud-sync-indicator.connected:hover {
    background-color: var(--surface-color);
}

.cloud-sync-indicator.connected .cloud-status-badge {
    background: var(--success-color);
    border: 2px solid var(--surface-color);
    /* Cutout effect */
    box-shadow: none;
    width: 10px;
    height: 10px;
    bottom: 4px;
    right: 4px;
}

/* État expiré - Nuage BLANC (fixe), point ORANGE */
.cloud-sync-indicator.expired {
    color: inherit;
    cursor: pointer;
    background-color: transparent;
}

.cloud-sync-indicator.expired:hover {
    background-color: var(--surface-color);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

.cloud-sync-indicator.expired .cloud-status-badge {
    background: var(--warning-color);
    border: 2px solid var(--surface-color);
    width: 10px;
    height: 10px;
    bottom: 4px;
    right: 4px;
}

/* État en cours de synchronisation - Spinner */
/* État en cours de synchronisation - Spinner */
.cloud-sync-indicator.syncing {
    color: var(--text-tertiary) !important;
    /* Force gray */
    cursor: wait;
}

.cloud-sync-indicator.syncing .cloud-status-badge {
    display: block !important;
    background: transparent !important;
    border: 2px solid rgba(156, 163, 175, 0.3);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    width: 10px;
    /* Match dot size */
    height: 10px;
    bottom: 4px;
    /* Match dot position */
    right: 4px;
    box-shadow: none;
    animation: spin-badge 0.8s linear infinite;
    z-index: 10;
}

/* Fix: Disable main icon rotation */
.cloud-sync-indicator.syncing i.fa-cloud,
.cloud-sync-indicator.syncing i.fa-hard-drive {
    animation: none !important;
    transform: none !important;
}

.cloud-sync-indicator.local .cloud-status-badge {
    display: none;
}

@keyframes spin-badge {
    to {
        transform: rotate(360deg);
    }
}


/* 2. Menu Button (Hamburger/Ellipsis) */
.menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.menu-btn i {
    font-size: 16px;
    /* Ensure 16px */
}

.menu-btn:hover,
.menu-btn.active {
    background-color: var(--surface-color);
    color: var(--text-primary);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1), 0 1px 1px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

.menu-btn:active {
    transform: scale(0.92);
    background-color: var(--surface-color);
    box-shadow: none;
}

[data-theme="dark"] .menu-btn:hover,
[data-theme="dark"] .menu-btn.active {
    background-color: var(--surface-color);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

/* Update indicator: Organic animation of the 3 dots (Pure CSS) */
.menu-btn.has-update {
    /* Switch to column layout to stack our 3 dots */
    flex-direction: column;
    gap: 3px;
    /* Ensure icon color transition works */
    color: var(--text-secondary);
}

/* 
   We construct the 3 dots using:
   1. ::before (Top)
   2. The existing <i> element (Middle)
   3. ::after (Bottom)
*/

/* Shared logic for all 3 dots */
.menu-btn.has-update::before,
.menu-btn.has-update::after,
.menu-btn.has-update i {
    content: '';
    display: block;
    width: 3.5px;
    height: 3.5px;
    min-width: 3.5px;
    min-height: 3.5px;
    border-radius: 50%;
    background-color: var(--text-secondary);
    transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    /* Animation base */
    animation: organic-pulse-dots 2.2s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95);
    /* Override FA specific styles for the middle dot */
    font-size: 0;
    line-height: 0;
    padding: 0;
    margin: 0;
    border: none;
}

/* Specific overrides to hide the original font icon glyph */
.menu-btn.has-update i::before {
    content: none !important;
    display: none !important;
}

/* Stagger delay for wave effect (Top -> Bottom) */
.menu-btn.has-update::before {
    animation-delay: 0s;
}

.menu-btn.has-update i {
    animation-delay: 0.15s;
}

.menu-btn.has-update::after {
    animation-delay: 0.3s;
}

@keyframes organic-pulse-dots {

    0%,
    100% {
        background-color: var(--text-secondary);
        transform: scale(1);
        box-shadow: none;
        opacity: 0.8;
    }

    50% {
        background-color: var(--primary-color);
        transform: scale(1.6);
        /* Glow effect matching primary color */
        box-shadow: 0 0 8px rgba(var(--primary-color-rgb), 0.6);
        opacity: 1;
    }
}

/* Update menu item style */
.menu-item.update-item {
    background-color: rgba(var(--primary-color-rgb), 0.08);
    color: var(--primary-color);
    font-weight: 500;
    margin-bottom: 4px;
}

.menu-item.update-item:hover {
    background-color: rgba(var(--primary-color-rgb), 0.15);
}

.menu-item.update-item i {
    color: var(--primary-color);
    /* Animation removed as requested */
}

/* 3. Dropdown Menu Container */
.dropdown-wrapper {
    position: relative;
}

.header-dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    width: 200px;
    background-color: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1), 0 0 10px rgba(0, 0, 0, 0.05);
    padding: 6px;
    display: none;
    /* Hidden by default */
    flex-direction: column;
    gap: 2px;
    z-index: 1000;
    transform-origin: top right;
    animation: menu-open 0.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

[data-theme="dark"] .header-dropdown-menu {
    box-shadow: 0 10px 40px -5px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
}

.header-dropdown-menu.open {
    display: flex;
}

@keyframes menu-open {
    from {
        opacity: 0;
        transform: scale(0.95);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Menu Items Styles */
.menu-item,
.menu-item-row {
    display: flex;
    align-items: center;
    width: 100%;
    padding: 8px 12px;
    font-size: 14px;
    color: var(--text-secondary);
    background: transparent;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    text-align: left;
    transition: all var(--transition-fast);
    gap: 10px;
}

.menu-item-row {
    justify-content: space-between;
    cursor: default;
    /* Row itself is not clickable if it contains a switch */
}

/* Hover effects for clickable items */
.menu-item:hover,
.menu-item-row:hover {
    color: var(--text-primary);
    background-color: rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .menu-item:hover,
[data-theme="dark"] .menu-item-row:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.menu-item i {
    font-size: 14px;
    color: var(--text-secondary);
    min-width: 18px;
    /* Alignment */
    display: flex;
    justify-content: center;
    align-items: center;
}

.menu-item:hover i {
    color: var(--text-primary);
}

/* Cloud Save Menu Item - Aligned with other menu items */
.cloud-save-menu-item {
    display: grid !important;
    /* Override flex */
    grid-template-columns: 18px 1fr;
    /* 18px matches .menu-item i min-width */
    grid-template-rows: auto auto;
    column-gap: 10px;
    /* Matches .menu-item gap */
    row-gap: 0;
    align-items: center;
    padding: 8px 12px;
    /* Matches .menu-item padding */
    height: auto;
}

.cloud-save-menu-item>i {
    grid-row: 1 / span 2;
    grid-column: 1;
    position: static;
    transform: none;
    font-size: 14px;
    /* Matches .menu-item i size */
    justify-self: start;
    /* Left align like others */
    color: var(--text-secondary);
    /* Standard color */
    margin-top: 2px;
    /* Optical center */
}

.cloud-save-menu-item:hover>i {
    color: var(--text-primary);
}

.cloud-save-menu-item .cloud-save-label {
    grid-column: 2;
    grid-row: 1;
    margin: 0;
    font-weight: 500;
    /* Standard weight but maybe slightly bolder? No, user wants consistency */
    color: var(--text-secondary);
    /* Standard color */
    font-size: 14px;
    line-height: 1.2;
}

.cloud-save-menu-item:hover .cloud-save-label {
    color: var(--text-primary);
}

.cloud-save-menu-item .cloud-save-time {
    grid-column: 2;
    grid-row: 2;
    margin: 0;
    font-size: 10px;
    color: var(--text-tertiary);
    font-weight: 400;
    line-height: 1.2;
}

.cloud-save-menu-item:hover .cloud-save-time {
    color: var(--text-secondary);
}

.cloud-save-menu-item.saving {
    cursor: wait;
    opacity: 0.7;
}

.cloud-save-menu-item.saving .cloud-save-label::after {
    content: '...';
    animation: ellipsis 1.2s steps(4, end) infinite;
}

@keyframes ellipsis {
    0% {
        content: '';
    }

    25% {
        content: '.';
    }

    50% {
        content: '..';
    }

    75% {
        content: '...';
    }
}

/* État désactivé (session expirée) */
.cloud-save-menu-item.disabled {
    opacity: 0.4;
    pointer-events: none;
    cursor: not-allowed;
}

.cloud-save-menu-item.disabled>i,
.cloud-save-menu-item.disabled .cloud-save-label {
    color: var(--text-tertiary);
}

/* Bouton Reconnexion - Style warning */
.cloud-reconnect-item {
    background-color: rgba(var(--warning-color-rgb), 0.1);
    color: var(--warning-color) !important;
    font-weight: 500;
}

.cloud-reconnect-item:hover {
    background-color: rgba(var(--warning-color-rgb), 0.2);
    color: var(--warning-color) !important;
}

.cloud-reconnect-item i {
    color: var(--warning-color) !important;
}

/* Separator Line */
#darkModeToggle {
    width: 36px;
    height: 20px;
    background-color: var(--border-color);
    border-radius: 20px;
    border: none;
    position: relative;
    cursor: pointer;
    padding: 0;
    transition: background-color 0.3s;
    flex-shrink: 0;
}

#darkModeToggle::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background-color: white;
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

/* Active state for toggle is handled by data-theme on body usually, but button itself might not have class.
   Actually current implementation toggles theme on #darkModeToggle CLICK.
   But we want a visual switch now.
   I need to make sure the button visual state matches the theme.
   Since theme is global, I will style based on [data-theme="dark"] parent logic?
   No, the button state logic is simple toggle.
   If dark mode is active, I need to style this button as 'on'.
*/

[data-theme="dark"] #darkModeToggle {
    background-color: var(--primary-color);
}

[data-theme="dark"] #darkModeToggle::after {
    transform: translateX(16px);
}

/* Hide original icon inside dark mode toggle if present */
#darkModeToggle i {
    display: none;
}

/* Separator Line */
.menu-separator {
    height: 1px;
    background-color: var(--border-color);
    margin: 4px 0;
    width: 100%;
}

/* Pill Divider (Vertical line in pill) - Hidden in minimalist mode */
.pill-divider {
    display: none;
}

/* ====================================================================
   Cloud Sync Indicator - États de connexion Google Drive
   ==================================================================== */
.cloud-sync-indicator {
    position: relative;
}

/* Annuler le scale sur l'icône pour éviter que le badge bouge */
.cloud-sync-indicator:hover i.fa-cloud {
    transform: none;
}

/* Badge de statut (coche ou exclamation) */
.cloud-status-badge {
    position: absolute;
    bottom: 3px;
    right: 3px;
    border-radius: 50%;
    width: 12px;
    height: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    font-size: 7px;
    line-height: 1;
}

.cloud-status-badge i {
    font-size: 7px;
}

/* CSS Blocks Cleaned Up - Merged above */


/* Animation supprimée pour éviter l'effet "erreur critique" trop agressif */
@keyframes cloud-pulse {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1);
    }
}

/* État synchronisation en cours - Rotation */
.cloud-sync-indicator.syncing {
    color: var(--primary-color);
}

.cloud-sync-indicator.syncing>i.fa-cloud {
    animation: cloud-sync-spin 1.5s linear infinite;
}

.cloud-sync-indicator.syncing .cloud-status-badge {
    display: none;
}

@keyframes cloud-sync-spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

/* État local - Mode hors-ligne ou non configuré */
.cloud-sync-indicator.local {
    color: var(--text-tertiary);
    cursor: pointer;
    opacity: 0.8;
    /* Légère transparence pour le rendre passif */
}

/* Au survol, on le rend plus visible pour inciter au clic */
.cloud-sync-indicator.local:hover {
    color: var(--text-primary);
    opacity: 1;
    background-color: rgba(0, 0, 0, 0.05);
}

/* Adaptation Dark Mode pour le hover local */
[data-theme="dark"] .cloud-sync-indicator.local:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

/* État déconnecté - Visible mais grisé */
.cloud-sync-indicator.disconnected {
    color: var(--text-tertiary);
    opacity: 0.5;
}

/* Tous les états sauf syncing sont cliquables */
.cloud-sync-indicator:not(.syncing) {
    cursor: pointer;
}

/* ====================================================================
   sidebar internals
   ==================================================================== */
.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    /* Pour le pseudo-élément */

    /* Le padding-top s'anime, le reste est fixe. */
    padding: calc(24px * (1 - var(--header-progress, 0))) 24px 0;
    /* La marge en bas est maintenant fixe pour garder un espace standard */
    margin-bottom: 18px;
    overflow: visible;
    /* Permettre au gradient de déborder */

    box-shadow: 0 2px 4px rgba(0, 0, 0, calc(0.05 * var(--header-progress, 0)));
    background: none;
    flex-shrink: 0;
    transition: none;
}


.sidebar-title-group {
    display: flex;
    align-items: center;
    gap: 12px;
    /* espacement logo-titre */
}

/* #appLogo {
    height: calc(40px * (1 - var(--header-progress, 0)));
    min-height: 0;
    width: auto;
    border-radius: var(--radius-pill);
    opacity: calc(1 - var(--header-progress, 0));
    transform: scale(calc(1 - 0.2 * var(--header-progress, 0)));
    transition: none;
    filter: brightness(0);
}

[data-theme="dark"] #appLogo {
    filter: none;
    opacity: 1;
} */

.sidebar .section-title {
    font-size: var(--font-xl);
    /* taille de titre de la maquette */
    font-weight: 700;
    color: var(--text-primary);
}

.input-panels-wrapper {
    flex-grow: 1;
    overflow-y: auto;
    padding: var(--space-5) var(--space-6) var(--space-6);
    /* padding-top ajouté pour espacer de la bordure */
    background: none;
    border-top: 1px solid var(--border-color);
    /* Bordure en haut comme en bas */
}

.sidebar-footer {
    padding: var(--space-4) var(--space-6);
    border-top: 1px solid var(--border-color);
    background: var(--surface-color);
    flex-shrink: 0;
}

/* Boutons du footer de saisie */
.sidebar-footer .btn-secondary#resetFormBtn,
.sidebar-footer .btn-secondary#clearImportBtn {
    /* Bouton "Vider" plus discret */
    font-size: 12px;
    padding: 8px 12px;
    opacity: 0.8;
}

.sidebar-footer .btn-secondary#resetFormBtn:hover,
.sidebar-footer .btn-secondary#clearImportBtn:hover {
    opacity: 1;
}

/* Groupement des boutons de génération */
.generation-buttons-group {
    display: flex;
    gap: 8px;
    flex: 1;
    justify-content: flex-end;
}

.single-student-actions,
.mass-import-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

/* ====================================================================
   Responsive Breakpoints
   ==================================================================== */

/* Tablette Large (max-width: 1200px) - Sidebar removed */



/* Tablette (max-width: 1024px) */
@media (max-width: 1024px) {
    .main-content {
        padding: var(--space-6) var(--space-6);
        /* Fixed 56px header + spacing */
        padding-top: calc(56px + var(--space-5));
    }

    /* Header inherits 16px from base - no override needed */
}

/* Tablette Small / Phablet (max-width: 768px) */
@media (max-width: 768px) {
    :root {
        --sidebar-width: 85%;
    }

    .app-layout {
        grid-template-columns: 1fr;
    }

    .main-content {
        padding: 16px;
        /* Fixed 56px header + 16px spacing */
        padding-top: calc(56px + 16px);
    }

    .header {
        padding: 0 var(--space-3);
        /* 12px - compact for mobile */
        gap: 6px;
        /* Horizontal scroll for narrow screens - dropdowns use position:fixed to escape clipping */
        overflow-x: auto;
        overflow-y: visible;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: var(--border-color) transparent;
        flex-wrap: nowrap;
    }

    .header::-webkit-scrollbar {
        height: 4px;
    }

    .header::-webkit-scrollbar-track {
        background: transparent;
    }

    .header::-webkit-scrollbar-thumb {
        background-color: var(--border-color);
        border-radius: 4px;
    }

    /* All header elements keep fixed size - header is scrollable */
    .header-center,
    .class-selector-wrapper,
    .header-context-chip,
    .header-actions,
    .header-gen-dashboard,
    .header-actions-pill {
        flex-shrink: 0;
        min-width: max-content;
    }

    .header-center {
        gap: 4px;
    }

    .header-context-chip {
        padding: 6px 10px;
        gap: 6px;
    }

    /* Compact AI model chip padding only - no text truncation */
    .ai-model-chip {
        padding: 6px 10px;
    }

    .section-title {
        font-size: var(--font-xl);
    }

    .sub-section-title {
        font-size: 1.1rem;
    }

    /* Header menu dropdown: fixed position to escape header overflow clipping */
    .header-dropdown-menu {
        position: fixed !important;
        top: 56px !important;
        right: 12px !important;
        left: auto !important;
        width: 200px;
        z-index: 9999;
    }
}

/* Mobile (max-width: 480px) */
@media (max-width: 480px) {
    .main-content {
        padding: 12px;
        /* Fixed 56px header + 12px spacing */
        padding-top: calc(56px + 12px);
    }

    .header {
        gap: 4px;
        padding: 0 var(--space-2);
        /* Tighter padding on very small screens */
    }

    /* All header elements keep fixed size - header scrolls */
    .class-selector-wrapper,
    .header-context-chip,
    .header-actions,
    .header-center,
    .header-actions-pill {
        flex-shrink: 0;
        min-width: max-content;
    }

    .header-context-chip {
        padding: 6px 8px;
        gap: 4px;
    }

    .header-actions {
        gap: 4px;
    }

    .header-center {
        gap: 2px;
    }

    /* Pilule plus compacte sur mobile */
    .header-actions-pill {
        padding: 3px;
    }

    .pill-segment {
        width: 32px;
        height: 28px;
    }

    .pill-segment i {
        font-size: var(--font-sm);
    }

    .section-title {
        font-size: 1.1rem;
    }

    .sub-section-title {
        font-size: 1rem;
    }

    .input-panels-wrapper {
        padding: 12px 12px 0;
    }

    .sidebar-footer {
        padding: 12px;
    }

    .sidebar-header {
        padding: calc(16px * (1 - var(--header-progress, 0))) 16px 0;
        margin-bottom: 16px;
    }

    #appLogo {
        height: calc(32px * (1 - var(--header-progress, 0)));
    }

    .sidebar .section-title {
        font-size: 1.1rem;
    }
}

/* ====================================================================
   ANIMATION: Class Switch (Premium Focus Switch)
   Blur + Pulse effect to mask data transition while keeping cards visible
   ==================================================================== */
@keyframes premium-context-switch {
    0% {
        transform: scale(1);
        filter: blur(0);
        opacity: 1;
    }

    30% {
        transform: scale(0.98);
        filter: blur(4px);
        opacity: 0.85;
    }

    50% {
        transform: scale(0.98);
        filter: blur(8px);
        opacity: 0.85;
    }

    70% {
        transform: scale(0.98);
        filter: blur(4px);
        opacity: 0.85;
    }

    100% {
        transform: scale(1);
        filter: blur(0);
        opacity: 1;
    }
}

.card-refresh-animation {
    animation: premium-context-switch 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    will-change: transform, filter, opacity;
    backface-visibility: hidden;
}

/* ====================================================================
   ANIMATION: Period Switch (Temporal Navigation)
   Horizontal slide + light blur - feels like flipping through time
   ==================================================================== */
@keyframes period-slide-switch {
    0% {
        transform: translateX(0) scale(1);
        filter: blur(0);
        opacity: 1;
    }

    40% {
        transform: translateX(-12px) scale(0.99);
        filter: blur(3px);
        opacity: 0.9;
    }

    60% {
        transform: translateX(12px) scale(0.99);
        filter: blur(3px);
        opacity: 0.9;
    }

    100% {
        transform: translateX(0) scale(1);
        filter: blur(0);
        opacity: 1;
    }
}

.period-refresh-animation {
    animation: period-slide-switch 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    will-change: transform, filter, opacity;
    backface-visibility: hidden;
}

/* ====================================================================
   ANIMATION: Filter/Sort Switch (Quick Fade)

/* ====================================================================
   PWA UPDATE TOAST (Premium Glassmorphism + Gradient)
   ==================================================================== */
/* ====================================================================
   PWA UPDATE TOAST (Premium Glassmorphism + Accordion Info)
   ==================================================================== */
.pwa-update-banner {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    z-index: 10000;

    display: flex;
    flex-direction: column;
    padding: 0;

    /* Premium Golden Sand Gradient matching Light Theme - Adjusted for Vibrancy */
    background: linear-gradient(135deg,
            rgba(200, 150, 75, 0.94) 0%,
            rgba(215, 165, 85, 0.92) 50%,
            rgba(230, 180, 100, 0.94) 100%);

    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);

    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: var(--radius-lg);

    box-shadow:
        0 20px 50px -12px rgba(200, 150, 75, 0.45),
        0 0 0 1px rgba(255, 255, 255, 0.15);

    animation: pwa-toast-enter 0.6s cubic-bezier(0.32, 0.72, 0, 1) forwards;
    width: min(420px, 90vw);
    overflow: hidden;
    /* For accordion expansion */
}

[data-theme="dark"] .pwa-update-banner {
    /* Refined Blue-Violet Gradient for Dark Theme */
    background: linear-gradient(135deg,
            rgba(85, 60, 180, 0.92) 0%,
            rgba(100, 75, 190, 0.9) 50%,
            rgba(75, 55, 160, 0.92) 100%);
    border-color: rgba(255, 255, 255, 0.18);
    box-shadow:
        0 24px 60px -12px rgba(75, 55, 160, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.08);
}

@keyframes pwa-toast-enter {
    to {
        transform: translateX(-50%) translateY(0);
    }
}

/* --- Main Banner Row --- */
.pwa-banner-main {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px 14px 20px;
    gap: 12px;
    width: 100%;
}

.pwa-banner-text {
    display: flex;
    align-items: center;
    gap: 14px;
    flex-grow: 1;
}

.pwa-gift-icon {
    font-size: 1.5rem;
    color: white;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.pwa-text-col {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.pwa-title {
    font-weight: 700;
    color: white;
    font-size: 0.95rem;
    line-height: 1.2;
    margin-bottom: 2px;
}

.pwa-subtitle {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.85);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 180px;
}

.pwa-banner-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

/* --- Details Section (Accordion) --- */
.pwa-banner-details {
    max-height: 0;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.15);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    transition: max-height 0.4s cubic-bezier(0.32, 0.72, 0, 1);
}

.pwa-banner-details.expanded {
    max-height: 200px;
    /* Allow enough space for content */
}

.pwa-details-content {
    padding: 12px 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-size: 0.85rem;
}

.pwa-detail-row {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    color: rgba(255, 255, 255, 0.9);
}

.pwa-detail-label {
    font-weight: 600;
    min-width: 70px;
    opacity: 0.8;
}

.pwa-detail-value {
    opacity: 0.95;
    line-height: 1.4;
}

.pwa-detail-code {
    font-family: 'JetBrains Mono', 'Menlo', monospace;
    background: rgba(0, 0, 0, 0.2);
    padding: 1px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
}

/* --- Buttons --- */
.pwa-info-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.15);
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.pwa-info-btn:hover,
.pwa-info-btn.active {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.pwa-info-btn i {
    font-size: 0.8rem;
    transition: transform 0.3s ease;
}

/* Update Button */
#pwaUpdateBanner .btn-primary {
    padding: 6px 14px;
    border-radius: var(--radius-pill);
    font-size: 0.85rem;
    font-weight: 600;
    background: white;
    color: var(--primary-color);
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    white-space: nowrap;
    transition: all 0.2s;
}

#pwaUpdateBanner .btn-primary:hover {
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-1px);
    opacity: 0.95;
}

/* Close Button */
.pwa-close-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    transition: color 0.2s;
}

.pwa-close-btn:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
}



/* Mobile adjustments for PWA Banner to prevent truncation */
@media (max-width: 480px) {
    .pwa-update-banner {
        width: calc(100vw - 24px);
        /* Maximize width with small margin */
        bottom: 12px;
    }

    .pwa-banner-main {
        flex-direction: column;
        align-items: stretch;
        padding: 16px;
        gap: 12px;
    }

    .pwa-banner-text {
        width: 100%;
    }

    .pwa-subtitle {
        max-width: 100%;
        /* Allow full width text */
        white-space: normal;
        /* Allow wrapping if needed */
    }

    .pwa-banner-actions {
        width: 100%;
        justify-content: space-between;
        padding-top: 4px;
    }

    #pwaUpdateBanner .btn-primary {
        flex-grow: 1;
        margin: 0 12px;
        justify-content: center;
        display: flex;
        height: 36px;
        /* Taller touch target */
        align-items: center;
    }

    .pwa-info-btn,
    .pwa-close-btn {
        width: 36px;
        /* Larger touch targets */
        height: 36px;
    }
}

/* End of layout.css */