/* ====================================================================
   MODULE: Import Wizard Modal
   iOS 2025 Premium Design - Clean wizard flow
   ==================================================================== */

/* === MODAL CONTAINER === */
.import-wizard-modal .modal-content {
    width: 1000px;
    max-width: 95vw;
    /* Fixed height for stability across steps */
    height: 680px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    /* Enforce standardized radius to match settings modal */
    border-radius: var(--radius-lg);
    /* Enforce strict clipping context to prevent corner bleeding */
    isolation: isolate;
}

/* Fix corner artifact: header needs to respect parent radius */
.import-wizard-modal .import-wizard-header-unified {
    /* Remove explicit radius to let overflow:hidden from modal-content handle the clipping perfectly */
    border-radius: 0;
    /* Ensure clean clipping */
    overflow: hidden;
}

/* Body fills remaining space without gaps */
.import-wizard-modal .import-wizard-body {
    border-radius: 0;
    background: var(--bg-color);
}

/* === SPLIT LAYOUT: Guide Panel + Main Content === */
.import-wizard-layout {
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

/* === GUIDE PANEL (Left Sidebar) === */
.wizard-guide-panel {
    width: 260px;
    min-width: 260px;
    background: rgba(var(--primary-color-rgb), 0.04);
    border-right: 1px solid var(--border-color);
    padding: 20px 18px;
    display: flex;
    flex-direction: column;
    gap: 0;
    overflow-y: auto;
}

.guide-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-color);
}

.guide-header i {
    color: #fbbf24;
    /* Amber-400 - Jaune dorÃ© lumineux (maquette) */
    font-size: 0.9rem;
}

/* Guide content sections - show/hide based on step */
.guide-content {
    display: none;
    flex-direction: column;
    gap: 0;
    animation: guideContentFadeIn 0.3s ease-out;
}

.guide-content.active {
    display: flex;
}

@keyframes guideContentFadeIn {
    from {
        opacity: 0;
        transform: translateY(8px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.guide-section {
    padding: 12px 0;
}

.guide-section-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.guide-section-title i {
    color: var(--primary-color);
    font-size: 0.85rem;
    width: 16px;
    text-align: center;
}

.guide-period-badge {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(var(--primary-color-rgb), 0.15);
    color: var(--primary-color);
    border-radius: var(--radius-pill);
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.guide-text {
    font-size: 0.78rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0 0 6px 0;
}

.guide-hint {
    font-size: 0.72rem;
    color: var(--text-tertiary);
    font-style: italic;
    margin: 0;
    line-height: 1.4;
}

.guide-hint.warning {
    color: var(--warning-color);
    font-style: normal;
    display: flex;
    align-items: center;
    gap: 6px;
}

.guide-hint.warning i {
    font-size: 0.7rem;
}

.guide-divider {
    height: 1px;
    background: var(--border-color);
    margin: 4px 0;
}

/* Guide source list (Step 1) */
.guide-source-list {
    list-style: none;
    padding: 0;
    margin: 8px 0 0 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.guide-source-list li {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.guide-source-list li i {
    width: 14px;
    text-align: center;
    color: var(--primary-color);
    font-size: 0.7rem;
}

/* Guide sample button */
.guide-sample-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 10px 14px;
    margin-top: 8px;
    background: rgba(var(--primary-color-rgb), 0.1);
    border: 1px solid rgba(var(--primary-color-rgb), 0.3);
    border-radius: var(--radius-md);
    color: var(--primary-color);
    font-size: 0.78rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.guide-sample-btn:hover {
    background: rgba(var(--primary-color-rgb), 0.18);
    border-color: var(--primary-color);
}

.guide-sample-btn i {
    font-size: 0.85rem;
}

/* Textarea clear button - positioned inside */
.import-input-container {
    position: relative;
}

.textarea-clear-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    background: rgba(var(--danger-color-rgb, 239, 68, 68), 0.1);
    border: none;
    border-radius: var(--radius-sm);
    color: var(--danger-color, #ef4444);
    font-size: 0.75rem;
    cursor: pointer;
    opacity: 0.7;
    transition: all var(--transition-fast);
}

.textarea-clear-btn:hover {
    opacity: 1;
    background: rgba(var(--danger-color-rgb, 239, 68, 68), 0.2);
}

/* === MAIN CONTENT AREA === */
.wizard-main-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Dark theme adjustments */
[data-theme="dark"] .wizard-guide-panel {
    background: rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .guide-format-chip {
    background: rgba(255, 255, 255, 0.05);
}

/* === RESPONSIVE: Hide guide panel on mobile === */
@media (max-width: 768px) {
    .wizard-guide-panel {
        display: none;
    }

    .import-wizard-layout {
        flex-direction: column;
    }
}

/* === UNIFIED HEADER === */
.import-wizard-header-unified {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: var(--surface-color);
    border-bottom: 1px solid var(--border-color);
    height: 58px;
}

.wizard-header-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.wizard-header-title i {
    color: var(--primary-color);
    font-size: 1.2rem;
}

/* Class name badge in header */
.wizard-class-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-pill);
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-left: 4px;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.wizard-class-badge:empty {
    display: none;
}

/* === COMPACT STEPPER === */
.import-wizard-stepper.compact {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0;
    background: transparent;
    border: none;
    margin: 0;
}

.import-wizard-stepper.compact .wizard-step {
    padding: 6px 12px;
    gap: 8px;
    background: transparent;
    color: var(--text-tertiary);
    font-size: 0.85rem;
}

.import-wizard-stepper.compact .wizard-step.active {
    /* Reset background color as we use layered images */
    background-color: transparent;
    color: var(--primary-color);

    /* Transparent border handles the spacing for the gradient border */
    border: 1.5px solid transparent;

    /* 
       Layer 1: The Blue Tint (Visual requirement) - clipped to padding
       Layer 2: The Surface Color (Opaque blocker) - clipped to padding
       Layer 3: The Conic Gradient (Border) - clipped to border
    */
    background-image:
        linear-gradient(rgba(var(--primary-color-rgb), 0.1), rgba(var(--primary-color-rgb), 0.1)),
        linear-gradient(var(--surface-color), var(--surface-color)),
        conic-gradient(from var(--gradient-angle),
            rgba(var(--primary-color-rgb), 0.5) 0%,
            rgba(var(--primary-color-rgb), 0.5) 18%,
            var(--glow-highlight) 23%,
            var(--glow-highlight) 27%,
            rgba(var(--primary-color-rgb), 0.5) 32%,
            rgba(var(--primary-color-rgb), 0.5) 50%,
            rgba(var(--primary-color-rgb), 0.5) 68%,
            var(--glow-highlight) 73%,
            var(--glow-highlight) 77%,
            rgba(var(--primary-color-rgb), 0.5) 82%,
            rgba(var(--primary-color-rgb), 0.5) 100%);

    background-origin: padding-box, padding-box, border-box;
    background-clip: padding-box, padding-box, border-box;

    /* Animation */
    animation: rotate-gradient 10s linear infinite;

    /* Box Shadow from inputs */
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.08), 0 2px 8px rgba(var(--primary-color-rgb), 0.1);
}

/* Fix for completed state overlay issue (legacy conflict) */
.import-wizard-stepper.compact .wizard-step.completed {
    color: var(--success-color);
    background: transparent;
    box-shadow: none;
}

.import-wizard-stepper.compact .wizard-step-number {
    width: 20px;
    height: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--text-tertiary);
    color: white;
    border-radius: 50%;
    position: relative;
    /* For absolute checkmark */
    display: flex;
    /* Ensure centering */
    align-items: center;
    justify-content: center;
}

.import-wizard-stepper.compact .wizard-step.active .wizard-step-number {
    background: var(--primary-color);
    color: white;
}

.import-wizard-stepper.compact .wizard-step.completed .wizard-step-number {
    background: var(--success-color);
    color: transparent;
    /* Hide number */
}

/* Kill legacy before if present */
.import-wizard-stepper.compact .wizard-step.completed .wizard-step-number::before {
    content: none !important;
}

/* Add clean checkmark centered */
.import-wizard-stepper.compact .wizard-step.completed .wizard-step-number::after {
    content: '\f00c';
    /* FA Check */
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    font-size: 0.65rem;
    color: white;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.import-wizard-stepper.compact .wizard-step-connector {
    width: 24px;
    height: 1px;
    background: var(--border-color);
}

/* Hide label on small screens for compact stepper */
@media (max-width: 800px) {
    .import-wizard-stepper.compact .wizard-step-label {
        display: none;
    }
}

/* === NAVIGATION ARROWS IN STEPPER === */
.wizard-nav-arrow {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: var(--bg-secondary);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    flex-shrink: 0;
}

.wizard-nav-arrow:hover:not(:disabled) {
    background: var(--primary-color);
    color: white;
    transform: scale(1.1);
}

.wizard-nav-arrow:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.wizard-nav-arrow i {
    font-size: 0.85rem;
}

/* Make steps clickable */
.import-wizard-stepper.compact .wizard-step[role="button"] {
    cursor: pointer;
}

.import-wizard-stepper.compact .wizard-step[role="button"]:hover:not(.active) {
    background: rgba(var(--primary-color-rgb), 0.05);
    color: var(--text-secondary);
}

/* === STEPPER === */
.import-wizard-stepper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 16px;
    background: var(--surface-color);
    border-bottom: 1px solid var(--border-color);
}

.wizard-step {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 18px;
    border-radius: var(--radius-pill);
    background: var(--bg-secondary);
    color: var(--text-tertiary);
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: default;
}

.wizard-step.active {
    background: var(--primary-color);
    color: white;
}

.wizard-step.completed {
    background: rgba(34, 197, 94, 0.15);
    color: var(--success-color);
    box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
}

.wizard-step-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 700;
}

.wizard-step.active .wizard-step-number {
    background: rgba(255, 255, 255, 0.3);
}

.wizard-step.completed .wizard-step-number {
    background: var(--success-color);
    color: white;
}

.wizard-step-label {
    display: none;
}

@media (min-width: 500px) {
    .wizard-step-label {
        display: inline;
    }
}

.wizard-step-connector {
    width: 32px;
    height: 2px;
    background: var(--border-color);
    border-radius: 1px;
}

/* === BODY === */
.import-wizard-body {
    padding: 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    /* CRITICAL: Must override .modal-body { overflow-y: auto } from modals.css */
    overflow: hidden !important;
}

/* === STEP CONTENT === */
.wizard-step-content {
    display: none;
}

.import-wizard-modal .wizard-step-content.active,
.wizard-step-content.active {
    display: flex !important;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    /* Fix for flex item scrolling */
    animation: wizard-fade-in 0.3s ease;
    /* overflow: hidden; - REMOVED to allow focus ring/shadows to spill out */
}

@keyframes wizard-fade-in {
    from {
        opacity: 0;
        transform: translateX(20px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.wizard-step-title {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
}

.wizard-step-header-group {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 0 15px 0;
    /* Equal padding: top matches the body padding offset */
    margin-bottom: 0;
    flex-wrap: wrap;
    gap: 16px;
}

.wizard-step-controls {
    display: flex;
    align-items: center;
    gap: 20px;
}

.period-indicator-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 12px;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    border-radius: var(--radius-pill);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* === STEP 1 LAYOUT - Equal Split === */
.step-one-layout {
    display: flex;
    flex-direction: column;
    gap: 12px;
    flex: 1;
    padding-top: 4px;
}

/* === ENHANCED DROP ZONE === */
.import-drop-zone {
    flex: 1;
    min-height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border: 2px dashed var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    /* Harmonize margin with textarea container for consistent alignment */
    margin: 4px;
}

.import-drop-zone::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(var(--primary-color-rgb), 0.08), transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.import-drop-zone:hover {
    border-color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.02);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
}

.import-drop-zone:hover::before {
    opacity: 1;
}

.import-drop-zone.dragging {
    border-color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.05);
    transform: scale(1.01);
    box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.15);
}

.drop-zone-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    text-align: center;
    z-index: 1;
    transition: opacity 0.3s ease;
}

/* === DROP ZONE LOADING STATE === */
.import-drop-zone.loading .drop-zone-content {
    opacity: 0.15;
    pointer-events: none;
}

.drop-zone-status {
    position: absolute;
    inset: 0;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    z-index: 10;
    background: rgba(var(--bg-color-rgb, 255, 255, 255), 0.6);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    border-radius: var(--radius-lg);
}

.import-drop-zone.loading .drop-zone-status {
    display: flex;
    animation: fade-in 0.3s ease;
}

.status-spinner {
    width: 36px;
    height: 36px;
    border: 3px solid var(--border-color);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.status-text {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

@keyframes fade-in {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* === FOOTER CENTER LAYOUT === */
/* Use position absolute for true centering between buttons */
.wizard-footer-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 16px;
}

/* Footer needs relative positioning for absolute child */
.import-wizard-footer {
    position: relative;
}

/* Hide empty badge slot */
#wizardFormatBadgeSlot:empty {
    display: none;
}

/* Compact format badge in footer */
.wizard-footer-center .format-detection-badge {
    padding: 6px 14px;
    font-size: 0.8rem;
    margin: 0;
    animation: badge-appear 0.4s cubic-bezier(0.32, 0.72, 0, 1);
}

.drop-zone-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(var(--primary-color-rgb), 0.12);
    border-radius: 50%;
    color: var(--primary-color);
    font-size: 1.25rem;
    transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1), background 0.3s ease;
}

.import-drop-zone:hover .drop-zone-icon {
    background: rgba(var(--primary-color-rgb), 0.18);
    transform: translateY(-3px) scale(1.05);
}

.drop-zone-icon i {
    animation: none;
}

.import-drop-zone:hover .drop-zone-icon i {
    animation: float-icon 2s ease-in-out infinite;
}

@keyframes float-icon {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-4px);
    }
}

.drop-zone-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.drop-zone-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.drop-zone-hint {
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

.drop-zone-hint u {
    color: var(--primary-color);
    text-decoration: none;
    border-bottom: 1px dashed var(--primary-color);
}

/* Subtle divider - more minimal */
.import-divider-horizontal {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-tertiary);
    font-size: 0.75rem;
    margin: 2px 0;
    opacity: 0.7;
}

.import-divider-horizontal::before,
.import-divider-horizontal::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border-color);
    opacity: 0.5;
}

.import-divider-horizontal span {
    padding: 4px 12px;
    background: transparent;
    border: none;
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.01em;
}

/* Textarea container with integrated actions */
.import-input-container {
    /* width: 100% REMOVED - flex: 1 handles sizing, and 100% + margin: 4px causes overflow */
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;

    /* Real Border Implementation - Single Source of Truth */
    border: var(--input-border-width) solid var(--border-color);
    box-shadow: none;
    /* Shadow handled by hover/focus only if needed, or remove inset */
    border-radius: var(--radius-lg);
    /* Use --surface-color to match search bar (consistent interactive element styling) */
    background: var(--surface-color);
    /* OPTIMIZED: Hardware acceleration to prevent painting flashes */
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: border-color;
    /* Faster linear transition */
    transition: border-color 0.1s linear;

    /* Safe margin for focus ring */
    margin: 4px;

    /* Clip children - REMOVED to prevent double-border artifact on rounding */
    /* overflow: hidden; */
    /* Fix z-index context */
    z-index: 10;
}

/* === FLOATING ACTIONS (Glassmorphism) === */
.step-actions-row {
    position: absolute;
    bottom: 12px;
    right: 12px;
    display: flex;
    gap: 8px;
    z-index: 20;
}

.btn-text-action {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: var(--text-secondary);
    font-size: 0.8rem;
    font-weight: 600;
    padding: 6px 12px;
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Dark mode adjustment for glass buttons */
/* Dark mode adjustment for glass buttons - More visible */
/* Dark mode adjustment for glass buttons - More visible */
[data-theme="dark"] .btn-text-action {
    background: rgba(30, 30, 30, 0.4);
    /* Lower opacity for glass effect */
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn-text-action:hover {
    background: rgba(var(--primary-color-rgb), 0.1);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(var(--primary-color-rgb), 0.2);
    border-color: var(--primary-color);
}

[data-theme="dark"] .btn-text-action:hover {
    background: rgba(var(--primary-color-rgb), 0.2);
    color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-text-action i {
    font-size: 0.75rem;
    opacity: 0.8;
}

/* Hover Effect - Clean Dynamic Color Change */
/* Exclude hover effect when focus is active to prevent conflict */
.import-input-container:hover:not(:has(.import-textarea:focus)) {
    border-color: rgba(var(--primary-color-rgb), 0.5);
    background-image: none !important;
    outline: none !important;
    /* Removed box-shadow on hover to prevent "double contour" illusion */
    box-shadow: none;
}

/* Focus State - Nebula Dynamic Gradient (Signature Effect) applied to container */
.import-input-container:has(.import-textarea:focus) {
    /* Use STRICT single source of truth for focus width */
    border: var(--input-border-width-focus) solid transparent;
    /* Match base background of textarea container */
    background-image: linear-gradient(var(--surface-color), var(--surface-color)),
        conic-gradient(from var(--gradient-angle),
            rgba(var(--primary-color-rgb), 0.5) 0%,
            rgba(var(--primary-color-rgb), 0.5) 18%,
            var(--glow-highlight) 23%,
            var(--glow-highlight) 27%,
            rgba(var(--primary-color-rgb), 0.5) 32%,
            rgba(var(--primary-color-rgb), 0.5) 50%,
            rgba(var(--primary-color-rgb), 0.5) 68%,
            var(--glow-highlight) 73%,
            var(--glow-highlight) 77%,
            rgba(var(--primary-color-rgb), 0.5) 82%,
            rgba(var(--primary-color-rgb), 0.5) 100%);

    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    animation: rotate-gradient 10s linear infinite;

    /* Soft glow + inner highlight */
    /* Exact Match to Global Components (Sharp Ring, no diffuse halo) */
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.08),
        0 2px 8px rgba(var(--primary-color-rgb), 0.1);
}

.import-textarea {
    width: 100%;
    flex: 1;
    min-height: 100px;
    /* Revert padding: Standard padding */
    padding: 16px 18px 48px 18px;
    font-size: 0.85rem;
    font-family: 'SF Mono', 'JetBrains Mono', 'Consolas', monospace;
    color: var(--text-primary);
    background: transparent;
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    /* Prevents double-radius clipping artifacts */
    border-radius: var(--radius-lg);
    resize: none;
    line-height: 1.6;
    letter-spacing: 0.01em;
}

/* OVERRIDE GLOBAL COMPONENT STYLES (CRITICAL) */
/* Must match specificity of components.css: textarea:hover:not(:disabled):not(:focus) */
.import-textarea:hover:not(:disabled):not(:focus),
.import-textarea:hover,
.import-textarea:focus {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    background-image: none !important;
    background-color: transparent !important;
    background-origin: initial !important;
    background-clip: initial !important;
}

/* Custom Scrollbar for Textarea - Stays inside rounded border */
.import-textarea::-webkit-scrollbar {
    width: var(--scrollbar-width);
    height: var(--scrollbar-width);
}

.import-textarea::-webkit-scrollbar-track {
    background: transparent;
    /* Push track inside the border-radius */
    margin-top: 8px;
    margin-bottom: 8px;
    margin-right: 4px;
}

.import-textarea::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: var(--radius-xs);
    /* Transparent border creates spacing from edge */
    border: 2px solid transparent;
    background-clip: padding-box;
}

.import-textarea::-webkit-scrollbar-thumb:hover {
    background-color: var(--text-secondary);
}

.import-textarea::placeholder {
    color: var(--text-tertiary);
    opacity: 0.7;
    font-style: italic;
}

/* === HEADER CONTROLS (Step 2) === */
.import-wizard-modal .import-detected-info {
    font-size: 0.8rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    /* Use --surface-color for consistency with search bar and other interactive elements */
    background: var(--surface-color);
    border-radius: var(--radius-pill);
    border: 1px solid var(--border-color);

    /* Centering logic */
    flex: 0 0 auto;
    justify-content: center;
    margin: 0 auto;

    /* Enhanced visibility */
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    font-weight: 500;
    color: var(--text-primary);
}

.import-wizard-modal .import-count-badge {
    background: var(--primary-color);
    color: white;
    font-weight: 600;
    padding: 2px 8px;
    min-width: 22px;
    text-align: center;
    border-radius: var(--radius-pill);
    font-size: 0.75rem;
    line-height: 1.2;
}

.import-wizard-modal .import-separator-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.import-wizard-modal .import-separator-select {
    padding: 6px 10px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    /* Use --surface-color for consistency with search bar */
    background: var(--surface-color);
    color: var(--text-primary);
    font-size: 0.85rem;
    cursor: pointer;
    min-width: 130px;
    transition: all var(--transition-fast);
}

.import-wizard-modal .import-separator-select:focus {
    border-color: var(--primary-color);
    outline: none;
}

.import-wizard-modal .import-separator-select:hover {
    border-color: var(--text-tertiary);
    background: var(--bg-secondary);
}

/* === AUTO-DETECT BUTTON - Format Applied Highlight === */
#wizardAutoDetectBtn.format-applied {
    background: rgba(var(--primary-color-rgb), 0.1);
    border-color: var(--primary-color);
    color: var(--primary-color);
    animation: pulse-subtle 2s ease-in-out infinite;
}

#wizardAutoDetectBtn.format-applied i {
    animation: sparkle 1.5s ease-in-out infinite;
}

@keyframes pulse-subtle {

    0%,
    100% {
        box-shadow: 0 0 0 0 rgba(var(--primary-color-rgb), 0.2);
    }

    50% {
        box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.1);
    }
}

@keyframes sparkle {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

/* === FORMAT DETECTION BADGE - Shows detected format (MBN, Pronote, etc.) === */
.format-detection-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 14px;
    margin: 8px auto 0;
    font-size: 0.82rem;
    font-weight: 600;
    border-radius: var(--radius-pill);
    animation: badge-appear 0.4s cubic-bezier(0.32, 0.72, 0, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.format-detection-badge i {
    font-size: 0.9rem;
}

/* MBN format (ENT) - Purple gradient */
.format-detection-badge.format-mbn {
    background: linear-gradient(135deg, #9333ea, #7c3aed);
    color: white;
}

/* Pronote format - Blue gradient */
.format-detection-badge.format-pronote {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
}

/* Vertical format - Teal gradient */
.format-detection-badge.format-vertical {
    background: linear-gradient(135deg, #14b8a6, #0d9488);
    color: white;
}

/* Generic format fallback */
.format-detection-badge:not(.format-mbn):not(.format-pronote):not(.format-vertical) {
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
}

@keyframes badge-appear {
    0% {
        opacity: 0;
        transform: translateY(-8px) scale(0.95);
    }

    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* === TOOLTIP ON TRUNCATED CELLS === */
.import-mapping-table td.has-tooltip {
    cursor: help;
    position: relative;
}

.import-mapping-table td.has-tooltip::after {
    content: '...';
    color: var(--text-tertiary);
}

/* === MAPPING TABLE === */
.import-wizard-modal .import-mapping-table-container {
    position: relative;
    /* CRITICAL: Must be hidden - only .table-scroll-wrapper handles scrolling */
    overflow: hidden !important;
    margin-top: 12px;
    border-radius: var(--radius-lg);
    background: var(--bg-secondary);
    box-shadow: var(--shadow-sm);
    /* Margin for potential focus rings/shadows */
    margin: 4px;
    margin-top: 12px;
    /* Flex Growth: Fill available space to fix gap issues */
    flex: 1;
    display: flex;
    flex-direction: column;
    /* Allow shrinking for small screens/zoom */
    min-height: 200px;

    /* Force GPU layer to ensure sticky children are clipped */
    transform: translateZ(0);
    /* Strict Stacking Context (Fixes bleed-through) */
    isolation: isolate;
    backface-visibility: hidden;
    z-index: 0;

    /* No padding - wrapper handles spacing */
    padding: 0;

    /* Smooth fade-in animation when table appears */
    animation: table-fade-in 0.4s ease-out;
}

@keyframes table-fade-in {
    from {
        opacity: 0;
        transform: translateY(10px) translateZ(0);
    }

    to {
        opacity: 1;
        transform: translateY(0) translateZ(0);
    }
}

.import-wizard-modal .import-mapping-table-container>.table-scroll-wrapper {
    /* SCROLL WRAPPER: Contains the table and handles all scrolling */
    overflow-x: auto;
    overflow-y: auto;
    /* Fill the container */
    flex: 1;
    /* Remove arbitrary limits */
    max-height: none;
    /* Inner radius slightly smaller than container */
    border-radius: calc(var(--radius-lg) - 1px);
    /* CRITICAL: Padding creates space INSIDE for the scrollbar tracks */
    /* This prevents scrollbars from overlapping the rounded corners */
    padding-right: 4px;
    padding-bottom: 4px;
}

/* Border overlay: Sits ABOVE scrollbars to clip them at rounded corners */
.import-wizard-modal .import-mapping-table-container::after {
    content: '';
    position: absolute;
    inset: 0;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    z-index: 20;
    /* Higher than sticky th (z-index: 10) and scrollbars */
    pointer-events: none;
}

/* === UNIFIED FOOTER - Single source of truth === */
.import-wizard-footer {
    display: none;
    /* Hidden by default */
    justify-content: space-between;
    align-items: center;
    padding: 10px 24px;
    background: var(--surface-color);
    border-top: 1px solid var(--border-color);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    gap: 16px;
    min-height: 50px;
}

/* Show footer based on active step */
.import-wizard-modal:has(#modalStep1.active) #wizardStep1Footer {
    display: flex;
    /* justify-content: flex-end; REMOVED to allow space-between (Cancel on left, Next on right) */
    /* Step 1: buttons on right */
}

.import-wizard-modal:has(#modalStep2.active) #wizardStep2Footer {
    display: flex;
}

.import-wizard-modal:has(#modalStep3.active) #wizardStep3Footer {
    display: flex;
}

.import-wizard-modal .import-mapping-table-container.horizontal-scroll {
    padding-bottom: 0;
    /* Remove padding to let scrollbar sit flush if needed */
}

/* Custom Scrollbar for the table wrapper */
.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar {
    height: var(--scrollbar-width);
    /* Horizontal */
    width: var(--scrollbar-width);
    /* Vertical - Same as horizontal for consistency */
}

.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar-track {
    background: transparent;
}

.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: var(--radius-xs);
}

.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar-corner {
    background: transparent;
}

.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar-thumb:hover {
    background-color: var(--text-secondary);
}

/* Hide default scrollbar buttons (arrows) */
.import-wizard-modal .table-scroll-wrapper::-webkit-scrollbar-button {
    display: none;
}

.import-wizard-modal .import-mapping-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 0.85rem;
    table-layout: auto;
    /* Let browser optimize column widths */
    background: var(--bg-secondary);
    /* Fill corners to prevent gray artifacts */
}

/* === AUTO-SIZED COLUMNS === */
.import-wizard-modal .import-mapping-table th,
.import-wizard-modal .import-mapping-table td {
    padding: 10px 16px;
    /* More breathing room */
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    border-right: none;
    /* Removed vertical borders for cleaner look */
    vertical-align: middle;
    white-space: nowrap;
    /* Keep content on one line */
}

/* === COLUMN WIDTHS (Millimetric Precision) === */
.import-wizard-modal .import-mapping-table th,
.import-wizard-modal .import-mapping-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    border-right: none;
    /* Removed vertical borders */
    vertical-align: middle;
}

.import-wizard-modal .import-mapping-table th:last-child,
.import-wizard-modal .import-mapping-table td:last-child {
    border-right: none;
}

/* Rounded Corners - Using container overflow instead of individual cell radius */
/* Removed individual cell border-radius to prevent gray corner artifacts */
/* The container (.import-mapping-table-container) already has border-radius: var(--radius-lg) and overflow is handled */

/* IMPORTANT: Headers must allow dropdown overflow */
.import-wizard-modal .import-mapping-table th {
    overflow: visible;
}

/* Name: Narrower as requested (~150px is usually enough for truncated names) */
.import-wizard-modal .import-mapping-table th.col-name,
.import-wizard-modal .import-mapping-table td.col-name {
    width: 130px;
    /* Reduced from 140px */
    min-width: 120px;
    max-width: 140px;
    font-weight: 600;
    /* Retain font-weight from original .col-name rule */
}

/* Status: Very narrow (~60-70px) */
.import-wizard-modal .import-mapping-table th.col-status,
.import-wizard-modal .import-mapping-table td.col-status {
    width: 60px;
    /* Reduced from 70px */
    min-width: 50px;
    max-width: 70px;
    text-align: center;
    /* Retain text-align from original .col-status rule */
}

/* Grade: Wider to show "Moy. T1" (prevent "M..") */
.import-wizard-modal .import-mapping-table th.col-grade,
.import-wizard-modal .import-mapping-table td.col-grade {
    width: 115px;
    /* Increased from 110px */
    min-width: 105px;
    max-width: 125px;
    text-align: center;
    /* Retain text-align from original .col-grade rule */
}

/* Text/Appreciation: Flexible but constrained */
.import-wizard-modal .import-mapping-table th.col-text,
.import-wizard-modal .import-mapping-table td.col-text {
    width: 250px;
    min-width: 200px;
    max-width: 350px;
}

/* Truncate long content with ellipsis (only for data cells) */
.import-wizard-modal .import-mapping-table td {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* === HEADER & CLOSE BUTTON === */
.import-wizard-modal .modal-header {
    border-bottom: 1px solid var(--border-color);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    /* Ensure context for absolute elements if needed */
}

/* Fix close button style - Harmonized with design tokens (Single Source of Truth) */
.import-wizard-modal .close-modal-btn {
    background: var(--close-btn-bg);
    border: none;
    color: var(--close-btn-color);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
}

.import-wizard-modal .close-modal-btn:hover {
    background: var(--close-btn-hover-bg);
    color: var(--close-btn-hover-color);
    transform: rotate(90deg);
}

.import-wizard-modal .import-mapping-table th:last-child,
.import-wizard-modal .import-mapping-table td:last-child {
    border-right: none;
}

/* === COMPACT HEADER CONTROLS === */
/* ... existing styles ... */

.import-wizard-modal .import-separator-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.import-wizard-modal .import-separator-row label {
    margin: 0;
    line-height: 1;
    /* Fix vertical alignment */
}

/* ... existing styles ... */

/* === MAPPING TABLE COLUMN WIDTHS === */
.import-wizard-modal .import-mapping-table th.col-name,
.import-wizard-modal .import-mapping-table td.col-name {
    min-width: 140px;
    max-width: 180px;
    font-weight: 600;
}

/* [Duplicate column styles removed for cleanup] */

.import-wizard-modal .import-mapping-table th {
    background: var(--surface-color);
    /* Distinct header background for better hierarchy */
    vertical-align: top;
    min-width: 190px;
    padding: 16px;
    position: sticky;
    top: 0;
    z-index: 10;
    border-bottom: 1px solid var(--border-color);
    /* Removing backdrop-filter to prevent corner rendering artifacts */

    /* Shadow for depth */
    /* Shadow removed to fix GPU performance issues during scroll */
    box-shadow: none;
    justify-content: flex-start;
    /* Left-align content (student count) */
}

/* Fix sticky header corners not clipping correctly - REVERTED */
/* Manual radius caused bleed-through on scroll. We rely on container overflow:hidden now. */
.import-wizard-modal .import-mapping-table th:first-child {
    border-top-left-radius: 0;
}

.import-wizard-modal .import-mapping-table th:last-child {
    border-top-right-radius: 0;
    border-right: none;
}

.import-wizard-modal .import-mapping-table tr:nth-child(even) td {
    background: rgba(var(--surface-color-rgb), 0.3);
}

/* Row Hover Effect - Premium Feel */
.import-wizard-modal .import-mapping-table tr:hover td {
    background: rgba(var(--primary-color-rgb), 0.05);
    cursor: default;
}

.import-wizard-modal .mapping-header-col {
    margin-bottom: 10px;
    font-size: 0.65rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
}

/* === CUSTOM DROPDOWN SELECT (Harmonized with dropdown.css) === */
.custom-select-wrapper {
    position: relative;
    width: 100%;
    font-family: inherit;
}

.custom-select-trigger {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    /* Closer to standard 12.5px but slightly compact for table */
    font-size: 14px;
    /* Standardize font size */
    font-weight: 500;
    color: var(--text-primary);
    background: var(--bg-color);
    border: 1.5px solid var(--border-color);
    /* Match standard border thickness */
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    user-select: none;
    min-height: 42px;
    /* Match standard height */
    white-space: nowrap;
}

/* Ensure text truncates properly */
.custom-select-trigger span {
    overflow: hidden;
    text-overflow: ellipsis;
    margin-right: 6px;
    flex: 1;
    /* Take available space */
}

.custom-select-trigger:hover {
    border-color: transparent;
    /* Subtle primary tint + gradient border (consistent with inputs) */
    background-image: linear-gradient(rgba(var(--primary-color-rgb), 0.03), rgba(var(--primary-color-rgb), 0.03)),
        linear-gradient(var(--bg-color), var(--bg-color)),
        linear-gradient(90deg, rgba(var(--primary-color-rgb), 0.5) 0%, rgba(var(--primary-color-rgb), 0.5) 100%);
    background-origin: padding-box, padding-box, border-box;
    background-clip: padding-box, padding-box, border-box;
    /* Copied from dropdown.css hover effect for consistency */
}

.custom-select-trigger.active {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
}

.custom-select-trigger i {
    font-size: 12px;
    color: var(--text-secondary);
    transition: transform 0.2s ease;
    flex-shrink: 0;
}

.custom-select-wrapper.open .custom-select-trigger i {
    transform: rotate(180deg);
    color: var(--primary-color);
}

/* Note: The options menu is now handled via JS Portal (appended to body), 
   but we keep styles here for the portal element which will use these classes */
.custom-select-options {
    /* Base styles for the portal element */
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    z-index: 9999;
    /* Very high for portal */
    max-height: 300px;
    overflow-y: auto;
    padding: 6px;
}

@keyframes slideDownFade {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.custom-option {
    padding: 8px 12px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: all 0.1s ease;
}

.custom-option:hover {
    background: rgba(var(--primary-color-rgb), 0.08);
    color: var(--primary-color);
}

.custom-option.selected {
    background: rgba(var(--primary-color-rgb), 0.15);
    color: var(--primary-color);
    font-weight: 600;
}

/* Scrollbar within dropdown */
.custom-select-options::-webkit-scrollbar {
    width: 4px;
}

.custom-select-options::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

/* Elegant selects in headers */
.import-wizard-modal .import-mapping-table select {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--surface-color);
    /* Solid background for legibility */
    color: var(--text-primary);
    font-size: 0.85rem;
    cursor: pointer;
    font-family: inherit;
    transition: all var(--transition-fast);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.import-wizard-modal .import-mapping-table select:hover {
    border-color: var(--text-tertiary);
    transform: translateY(-1px);
}

.import-wizard-modal .import-mapping-table select:focus {
    background: var(--bg-color);
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
    outline: none;
    transform: none;
}

/* === STEP 3 - CONFIRMATION LAYOUT === */
#modalStep3 {
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    flex: 1;
    min-height: 0;
    height: 100%;
}

.wizard-step3-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
    flex-shrink: 0;
    padding: 0 8px;
}

.wizard-step3-header .wizard-step-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.period-badge-pill {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    padding: 6px 14px;
    border-radius: var(--radius-pill);
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap;
}

/* === PREVIEW GRID - ULTIMA DESIGN === */
.import-wizard-modal .import-preview-grid {
    display: flex;
    gap: 16px;
    /* REDUCED from 24px to fit 3 columns */
    margin-bottom: 0;
    justify-content: center;
    align-items: stretch;
    flex: 1 1 0;
    min-height: 200px;
    padding: 8px 0;
    overflow: hidden;
}

.import-wizard-modal .import-preview-col {
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    max-width: 320px;
    /* REDUCED from 420px */
    min-width: 200px;
    /* REDUCED from 260px */
    transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    box-shadow: var(--shadow-sm);
}

.import-wizard-modal .import-preview-col:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: rgba(var(--primary-color-rgb), 0.3);
}

/* Header Area */
.import-wizard-modal .import-col-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-secondary);
    flex-shrink: 0;
}

.import-wizard-modal .import-col-header i {
    font-size: 1rem;
}

.import-wizard-modal .import-col-count {
    margin-left: auto;
    padding: 3px 8px;
    background: var(--bg-color);
    border-radius: var(--radius-pill);
    font-size: 0.75rem;
    font-weight: 700;
    min-width: 24px;
    text-align: center;
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.import-wizard-modal .import-col-count.pop {
    transform: scale(1.2);
}

/* Color Coding */
.import-wizard-modal .import-col-new {
    border-top: 3px solid var(--success-color);
}

.import-wizard-modal .import-col-new .import-col-header {
    color: var(--success-color);
}

.import-wizard-modal .import-col-new .import-col-count {
    color: var(--success-color);
    background: rgba(34, 197, 94, 0.1);
}

.import-wizard-modal .import-col-updated {
    border-top: 3px solid var(--primary-color);
}

.import-wizard-modal .import-col-updated .import-col-header {
    color: var(--primary-color);
}

.import-wizard-modal .import-col-updated .import-col-count {
    color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.1);
}

.import-wizard-modal .import-col-departed {
    border-top: 3px solid var(--warning-color);
}

.import-wizard-modal .import-col-departed .import-col-header {
    color: var(--warning-color);
}

.import-wizard-modal .import-col-departed .import-col-count {
    color: var(--warning-color);
    background: rgba(249, 115, 22, 0.1);
}

/* List Styles */
.import-wizard-modal .import-col-list {
    list-style: none;
    padding: 12px;
    margin: 0;
    overflow-y: auto;
    flex: 1;
    font-size: 0.85rem;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.import-wizard-modal .import-col-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: var(--bg-color);
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    transition: background 0.15s ease;
    flex-shrink: 0;
}


.import-wizard-modal .import-col-list li:hover {
    background: rgba(var(--primary-color-rgb), 0.05);
}

/* Avatar in List */
.import-wizard-modal .li-avatar {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: var(--bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--text-secondary);
    flex-shrink: 0;
}

.import-col-new .li-avatar {
    background: rgba(34, 197, 94, 0.1);
    color: var(--success-color);
}

.import-col-updated .li-avatar {
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--primary-color);
}

.import-col-departed .li-avatar {
    background: rgba(249, 115, 22, 0.1);
    color: var(--warning-color);
}

.import-wizard-modal .li-name {
    font-size: 0.8rem;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.import-wizard-modal .empty-state-li {
    text-align: center;
    color: var(--text-tertiary);
    font-style: italic;
    padding: 24px 16px;
    background: transparent !important;
    border: 1px dashed var(--border-color) !important;
    justify-content: center;
    align-items: center;
    opacity: 0.6;
    font-size: 0.8rem;
    flex: 1;
    min-height: 100px;
}

/* === STRATEGY CARDS - CLEAN DESIGN === */
.import-wizard-modal .import-strategy-row {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 0;
    padding: 0;
}

.import-wizard-modal .import-strategy-option {
    flex: 1;
    max-width: 280px;
    position: relative;
    padding: 16px;
    background: var(--surface-color);
    border: 1.5px solid var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    gap: 14px;
    text-align: left;
}

/* Hover Effect */
.import-wizard-modal .import-strategy-option:hover {
    border-color: rgba(var(--primary-color-rgb), 0.4);
    background: rgba(var(--primary-color-rgb), 0.02);
}

/* Selected State */
.import-wizard-modal .import-strategy-option:has(input:checked) {
    border-color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.05);
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
}

/* Icon Container */
.import-wizard-modal .import-strategy-icon {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    background: var(--bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
    flex-shrink: 0;
}

.import-wizard-modal .import-strategy-option:hover .import-strategy-icon {
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--primary-color);
}

.import-wizard-modal .import-strategy-option:has(input:checked) .import-strategy-icon {
    background: var(--primary-color);
    color: white;
}

/* Text Content */
.import-wizard-modal .import-strategy-label {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.import-wizard-modal .import-strategy-label strong {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
}

.import-wizard-modal .import-strategy-label small {
    font-size: 0.8rem;
    color: var(--text-secondary);
    line-height: 1.3;
}

/* Checkmark indicator for selected state */
.import-wizard-modal .import-strategy-option::after {
    content: '\f00c';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    top: 10px;
    right: 10px;
    width: 20px;
    height: 20px;
    background: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    opacity: 0;
    transform: scale(0);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.import-wizard-modal .import-strategy-option:has(input:checked)::after {
    opacity: 1;
    transform: scale(1);
}

/* === FOOTER - NOTE: Main definition is at line ~650 === */
/* Additional footer rules below - DO NOT add display: flex here */

.import-wizard-footer #wizardBackBtn {
    margin-right: auto;
    /* Pushes everything else to the right */
}

.wizard-footer-right {
    display: flex;
    gap: 10px;
    margin-left: auto;
    /* Ensures right alignment even if Back is hidden/missing */
}

/* === RESPONSIVE === */
@media (max-width: 600px) {
    .import-wizard-modal .import-preview-grid {
        grid-template-columns: 1fr;
    }

    .import-wizard-modal .import-strategy-row {
        flex-direction: column;
    }

    .wizard-footer-right {
        flex-direction: column;
        width: 100%;
    }

    .wizard-footer-right .btn {
        width: 100%;
    }
}

/* === HEADER & CLOSE BUTTON FIX === */
.import-wizard-modal .modal-header {
    border-bottom: 1px solid var(--border-color);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

/* Sample button row - now positioned inside textarea container with high Z-index */
.step-actions-row {
    position: absolute;
    bottom: 16px;
    right: 18px;
    z-index: 10;
    /* Ensure strictly above textarea */
    display: flex;
    gap: 8px;
    /* Space between buttons */
    pointer-events: auto;
    /* Ensure clickable */
}

.btn-text-action {
    background: rgba(var(--surface-color-rgb, 30, 30, 35), 0.85);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(var(--border-color-rgb, 255, 255, 255), 0.1);
    color: var(--text-tertiary);
    font-size: 0.75rem;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.25s cubic-bezier(0.32, 0.72, 0, 1);
    opacity: 0.7;
}

.btn-text-action:hover {
    background: var(--surface-color);
    border-color: var(--primary-color);
    color: var(--primary-color);
    opacity: 1;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.15);
}

/* Close button already defined above - this block is duplicate and should be removed */
/* See line ~993 for the Single Source of Truth */

/* === MAPPING TABLE COLUMN WIDTHS === */
.import-wizard-modal .import-mapping-table th.col-grade,
.import-wizard-modal .import-mapping-table td.col-grade {
    min-width: 70px;
    max-width: 90px;
    text-align: center;
    color: var(--primary-color);
    font-weight: 600;
    font-variant-numeric: tabular-nums;
}

.import-wizard-modal .import-mapping-table th.col-status,
.import-wizard-modal .import-mapping-table td.col-status {
    min-width: 120px;
}

.import-wizard-modal .import-mapping-table th.col-text,
.import-wizard-modal .import-mapping-table td.col-text {
    min-width: 250px;
    width: auto;
    color: var(--text-secondary);
    font-style: italic;
    font-size: 0.8rem;
}

/* === ADDITIONAL PILL COLORS === */
.mapping-pill.type-status {
    background: rgba(245, 158, 11, 0.1);
    border-color: rgba(245, 158, 11, 0.3);
    color: rgb(245, 158, 11);
}

.mapping-pill.type-app {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
    color: rgb(16, 185, 129);
}

/* === FORMAT TOGGLE SWITCH === */
.format-toggle-container {
    display: flex;
    align-items: center;
    margin-left: auto;
}

.format-toggle {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    user-select: none;
}

.format-toggle input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.format-toggle-slider {
    position: relative;
    width: 44px;
    height: 24px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 24px;
    transition: all 0.3s ease;
}

.format-toggle-slider::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Checked state */
.format-toggle input:checked+.format-toggle-slider {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

.format-toggle input:checked+.format-toggle-slider::before {
    transform: translateX(20px);
}

/* Hover state */
.format-toggle:hover .format-toggle-slider {
    border-color: var(--primary-color);
}

/* Label */
.format-toggle-label {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-secondary);
    transition: color 0.2s ease;
    min-width: 70px;
}

.format-toggle input:checked~.format-toggle-label {
    color: var(--primary-color);
    font-weight: 600;
}

/* ====================================================================
   PREMIUM EVOLUTION - Added Enhancements
   ==================================================================== */

/* === DROP ZONE PREMIUM HOVER === */
.import-drop-zone-compact {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.import-drop-zone-compact::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(var(--primary-color-rgb), 0.08), transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.import-drop-zone-compact:hover::before {
    opacity: 1;
}

.import-drop-zone-compact:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
}

.import-drop-zone-compact:hover i {
    animation: float-icon 2s ease-in-out infinite;
}

@keyframes float-icon {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-4px);
    }
}

.import-drop-zone-compact.dragging {
    border-color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.05);
    transform: scale(1.02);
}

/* === STEPPER PULSE ANIMATION === */
.wizard-step.active .wizard-step-number {
    /* Static shadow instead of animation (GPU Optimization) */
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.2);
}

/* === MAGIC PILLS ENHANCED === */
.mapping-pills-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 0;
}

.mapping-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: var(--radius-pill);
    font-size: 0.8rem;
    font-weight: 600;
    border: 1px solid;
    transition: all var(--transition-fast);
    cursor: default;
}

.mapping-pill:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.mapping-pill-col {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    font-size: 0.7rem;
    font-weight: 700;
}

/* Pill Type Colors */
.mapping-pill.type-name {
    background: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.3);
    color: rgb(59, 130, 246);
}

.mapping-pill.type-grade {
    background: rgba(249, 115, 22, 0.1);
    border-color: rgba(249, 115, 22, 0.3);
    color: rgb(249, 115, 22);
}

.mapping-pill.type-context {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.3);
    color: rgb(139, 92, 246);
}

.mapping-pill.type-ignored {
    background: rgba(107, 114, 128, 0.08);
    border-color: rgba(107, 114, 128, 0.2);
    color: rgb(107, 114, 128);
    opacity: 0.7;
}

/* === STUDENT LIST CASCADE ANIMATION === */
.import-col-list li {
    animation: cascade-in 0.3s ease forwards;
    opacity: 0;
    transform: translateY(10px);
}

.import-col-list li:nth-child(1) {
    animation-delay: 0.05s;
}

.import-col-list li:nth-child(2) {
    animation-delay: 0.1s;
}

.import-col-list li:nth-child(3) {
    animation-delay: 0.15s;
}

.import-col-list li:nth-child(4) {
    animation-delay: 0.2s;
}

.import-col-list li:nth-child(5) {
    animation-delay: 0.25s;
}

.import-col-list li:nth-child(6) {
    animation-delay: 0.3s;
}

.import-col-list li:nth-child(7) {
    animation-delay: 0.35s;
}

.import-col-list li:nth-child(8) {
    animation-delay: 0.4s;
}

@keyframes cascade-in {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Corner icons removed - redundant with main center icon */

/* === STEP TRANSITION ENHANCEMENT === */
.wizard-step-content.active {
    animation: wizard-slide-in 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

@keyframes wizard-slide-in {
    from {
        opacity: 0;
        transform: translateX(30px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* === DROPDOWN COLOR CODING BY TYPE === */
.custom-select-trigger[data-type="name"] {
    border-left: 3px solid rgb(59, 130, 246);
}

.custom-select-trigger[data-type="grade"] {
    border-left: 3px solid rgb(249, 115, 22);
}

.custom-select-trigger[data-type="status"] {
    border-left: 3px solid rgb(245, 158, 11);
}

.custom-select-trigger[data-type="appreciation"] {
    border-left: 3px solid rgb(16, 185, 129);
}

.custom-select-trigger[data-type="context"] {
    border-left: 3px solid rgb(139, 92, 246);
}

.custom-select-trigger[data-type="ignored"] {
    border-left: 3px solid rgb(107, 114, 128);
    opacity: 0.7;
}

/* === PREVIEW COUNT ANIMATION === */
.import-data-count .count-number {
    display: inline-block;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary-color);
    animation: count-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes count-pop {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }

    70% {
        transform: scale(1.1);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* === MAPPING TABLE SCROLL SHADOW === */
.import-mapping-table-container {
    position: relative;
}

.import-mapping-table-container::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 40px;
    height: 100%;
    background: linear-gradient(to left, var(--surface-color), transparent);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.import-mapping-table-container.has-scroll::after {
    opacity: 1;
}

/* === SIMPLIFIED WIZARD FOOTER === */
/* NOTE: Main definition including display logic is at line ~650. DO NOT redefine display here. */

.import-wizard-footer .wizard-footer-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

/* === STEP 3 ACTION BUTTONS === */
.wizard-step-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

/* === PREVIEW HINT MESSAGE === */
.mapping-preview-hint {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    margin-top: 12px;
    background: rgba(var(--primary-color-rgb), 0.05);
    border-radius: var(--radius-md);
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.mapping-preview-hint i {
    color: var(--primary-color);
}

/* === STEP 3 SINGLE ACTION BUTTON === */
#wizardStep3Actions {
    display: flex;
    justify-content: center;
    margin-top: 24px;
    padding: 0;
}

/* Import Confirm Button - Extends .btn-organic */
/* NOTE: Ajouter la classe .btn-organic dans le HTML pour hÃ©riter de l'animation */
.btn-import-confirm {
    /* Sizing spÃ©cifique pour ce contexte */
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 24px;
    font-size: 0.95rem;
}

.btn-import-confirm i {
    font-size: 1rem;
}

/* Count badge inside button */
.btn-import-confirm #wizardImportCount {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    padding: 0 6px;
    background: rgba(255, 255, 255, 0.25);
    border-radius: var(--radius-pill);
    font-size: 0.85rem;
    font-weight: 700;
}

/* ====================================================================
   STEP 3 REDESIGN - Matching Mockup Design
   ==================================================================== */

/* === STEP 3 HEADER === */
.wizard-step3-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    gap: 16px;
}

.wizard-step3-header-left {
    flex: 1;
}

.wizard-step3-header .wizard-step-title {
    margin: 0 0 4px 0;
}

.wizard-step-subtitle {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 400;
}

/* Period Badge Pill */
.period-badge-pill {
    display: inline-flex;
    align-items: center;
    padding: 6px 14px;
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-pill);
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-secondary);
    white-space: nowrap;
    flex-shrink: 0;
}

/* === ENHANCED PREVIEW COLUMNS === */
.import-wizard-modal .import-preview-col {
    min-height: 200px;
    /* max-height removed to allow columns to expand */
}

.import-wizard-modal .import-col-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

/* Enhanced List Items with Secondary Info */
.import-wizard-modal .import-col-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    background: var(--bg-color);
    border-radius: var(--radius-md);
    margin-bottom: 6px;
    min-height: auto;
}

.import-wizard-modal .li-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 0.7rem;
}

.import-wizard-modal .li-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    min-width: 0;
}

.import-wizard-modal .li-name {
    font-size: 0.85rem;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.import-wizard-modal .li-secondary {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Change indicator for updated students */
.import-wizard-modal .li-change {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.7rem;
    color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.1);
    padding: 2px 6px;
    border-radius: var(--radius-sm);
    white-space: nowrap;
}

.import-wizard-modal .li-change i {
    font-size: 0.6rem;
}

/* Departure reason styling */
.import-wizard-modal .import-col-departed .li-secondary {
    color: var(--warning-color);
    font-style: italic;
}

/* === STRATEGY SECTION - RADIO STYLE === */
.import-strategy-section {
    display: flex;
    gap: 16px;
    margin-top: 20px;
    flex-shrink: 0;
}

.import-strategy-radio {
    flex: 1;
    position: relative;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: var(--surface-color);
    border: 1.5px solid var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.import-strategy-radio input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

/* Radio Indicator */
.strategy-radio-indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid var(--border-color);
    background: var(--bg-color);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--transition-fast);
    margin-top: 2px;
}

.import-strategy-radio:hover .strategy-radio-indicator {
    border-color: var(--primary-color);
}

.import-strategy-radio:has(input:checked) .strategy-radio-indicator {
    border-color: var(--primary-color);
    background: var(--primary-color);
}

.import-strategy-radio:has(input:checked) .strategy-radio-indicator::after {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: white;
}

/* Strategy Icon */
.import-strategy-radio .strategy-icon {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-top: 2px;
    flex-shrink: 0;
    transition: color 0.2s ease;
}

.import-strategy-radio:has(input:checked) .strategy-icon {
    color: var(--primary-color);
}

/* Strategy Content */
.strategy-radio-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
}

.strategy-radio-content strong {
    font-size: 0.95rem;
    color: var(--text-primary);
}

.strategy-desc {
    font-size: 0.8rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

/* Check indicator */
.strategy-check {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    opacity: 0;
    transform: scale(0);
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.import-strategy-radio:has(input:checked) .strategy-check {
    opacity: 1;
    transform: scale(1);
}

/* Selected state */
.import-strategy-radio:has(input:checked) {
    border-color: var(--primary-color);
    background: rgba(var(--primary-color-rgb), 0.03);
}

.import-strategy-radio:hover {
    border-color: rgba(var(--primary-color-rgb), 0.4);
}

/* Hide body bottom radius when any footer is visible (handled by unified footer) */
.import-wizard-modal:has(.import-wizard-footer:not([style*="display: none"])) .import-wizard-body {
    border-radius: 0;
}

.step3-footer-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

.step3-footer-warning i {
    font-size: 0.9rem;
    color: var(--warning-color);
}

.step3-footer-warning span {
    color: var(--text-tertiary);
}

/* PrÃ©cÃ©dent button with icon */
.import-wizard-footer .btn-ghost {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

/* Ghost button - hÃ©rite de components.css */

/* === RESPONSIVE === */
@media (max-width: 768px) {
    .import-strategy-section {
        flex-direction: column;
    }

    .wizard-step3-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .import-wizard-footer {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
    }

    .step3-footer-warning {
        justify-content: center;
    }

    .step3-footer-actions {
        justify-content: stretch;
    }

    .step3-footer-actions .btn {
        flex: 1;
    }
}

/* ====================================================================
   STEP 2 MAPPING IMPROVEMENTS
   ==================================================================== */

/* === STATUS BADGE CELLS === */
.status-badge-cell {
    display: inline-block;
    padding: 3px 10px;
    background: rgba(16, 185, 129, 0.15);
    color: rgb(16, 185, 129);
    border-radius: var(--radius-pill);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
}

/* Different status colors */
.status-badge-cell:empty {
    display: none;
}

/* Nouveau status - Blue */
.status-badge-cell.status-nouveau {
    background: rgba(59, 130, 246, 0.15);
    color: rgb(59, 130, 246);
}

/* DÃ©part status - Orange */
.status-badge-cell.status-depart {
    background: rgba(249, 115, 22, 0.15);
    color: rgb(249, 115, 22);
}

/* PPRE - Green */
.status-badge-cell.status-ppre {
    background: rgba(16, 185, 129, 0.15);
    color: rgb(16, 185, 129);
}

/* PAP - Purple */
.status-badge-cell.status-pap {
    background: rgba(139, 92, 246, 0.15);
    color: rgb(139, 92, 246);
}

/* ULIS - Amber */
.status-badge-cell.status-ulis {
    background: rgba(245, 158, 11, 0.15);
    color: rgb(245, 158, 11);
}

/* Default status */
.status-badge-cell.status-default {
    background: rgba(107, 114, 128, 0.15);
    color: rgb(107, 114, 128);
}

/* === SEPARATOR DROPDOWN ENHANCEMENT === */
.import-wizard-modal .import-separator-select {
    padding: 6px 28px 6px 12px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 12px;
}

/* === IMPROVED TABLE FOR ALL ROWS === */
.import-wizard-modal .import-mapping-table-container {
    flex: 1;
    overflow-y: auto;
    overflow-x: auto;
    min-height: 200px;
}

/* === SMART COLUMN WIDTHS === */

/* Base table layout - auto columns by content type */
.import-wizard-modal .import-mapping-table {
    table-layout: auto;
    width: 100%;
}

/* 1. Name column - flexible but minimum width */
.import-wizard-modal .import-mapping-table th:first-child,
.import-wizard-modal .import-mapping-table td:first-child {
    font-weight: 500;
    min-width: 140px;
    width: auto;
    white-space: nowrap;
    overflow: visible;
    text-overflow: clip;
}

/* 2. Status column - compact */
.import-wizard-modal .import-mapping-table th:nth-child(2),
.import-wizard-modal .import-mapping-table td:nth-child(2) {
    text-align: center;
    width: 110px;
    min-width: 100px;
    max-width: 140px;
}

/* 3+ Columns: Dynamic based on content type */
/* Use select value to style headers */
.import-wizard-modal .import-mapping-table th {
    padding: 10px 8px;
}

/* Grade/Note columns - very compact (numeric values) */
.import-wizard-modal .import-mapping-table select[value^="MOY_"]~td,
.import-wizard-modal .import-mapping-table td.col-grade {
    width: 70px;
    min-width: 60px;
    max-width: 80px;
    text-align: center;
    font-variant-numeric: tabular-nums;
    color: var(--primary-color);
    font-weight: 500;
}

/* Force compact width on grade cells via nth-child pattern (Moy is typically col 3, 5, 7...) */
.import-wizard-modal .import-mapping-table td:nth-child(3),
.import-wizard-modal .import-mapping-table td:nth-child(5),
.import-wizard-modal .import-mapping-table td:nth-child(7) {
    width: 70px;
    min-width: 55px;
    max-width: 85px;
    text-align: center;
    font-variant-numeric: tabular-nums;
    color: var(--primary-color);
    font-weight: 500;
}

/* Header cells for grade columns - compact */
.import-wizard-modal .import-mapping-table th:nth-child(3),
.import-wizard-modal .import-mapping-table th:nth-child(5),
.import-wizard-modal .import-mapping-table th:nth-child(7) {
    width: 100px;
    min-width: 90px;
}

/* Appreciation columns - wider, flexible (col 4, 6, 8...) */
.import-wizard-modal .import-mapping-table td:nth-child(4),
.import-wizard-modal .import-mapping-table td:nth-child(6),
.import-wizard-modal .import-mapping-table td:nth-child(8) {
    color: var(--text-secondary);
    font-style: italic;
    min-width: 120px;
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Header cells for appreciation columns */
.import-wizard-modal .import-mapping-table th:nth-child(4),
.import-wizard-modal .import-mapping-table th:nth-child(6),
.import-wizard-modal .import-mapping-table th:nth-child(8) {
    min-width: 130px;
}

/* Last column (Context) - wider */
.import-wizard-modal .import-mapping-table th:last-child,
.import-wizard-modal .import-mapping-table td:last-child {
    min-width: 150px;
    max-width: 250px;
}

/* ====================================================================
   STEP 1 FOOTER
   ==================================================================== */

.wizard-step1-footer {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 12px;
    margin-top: auto;
    padding: 16px 0;
}

.wizard-step1-footer .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    font-weight: 500;
}

.wizard-step1-footer .btn-primary i {
    font-size: 0.85rem;
}

/* Disabled state for Next button */
.wizard-step1-footer .btn-primary:disabled {
    background: var(--bg-secondary);
    color: var(--text-tertiary);
    cursor: not-allowed;
    opacity: 0.6;
}

.wizard-step1-footer .btn-primary:disabled:hover {
    background: var(--bg-secondary);
    transform: none;
    box-shadow: none;
}

/* === STEP 2 FOOTER === */
.wizard-step2-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
    flex-shrink: 0;
}

.wizard-step2-footer .btn-ghost {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.wizard-step2-footer .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    font-weight: 500;
}

/* Textarea should expand in step 1 */
.import-wizard-modal .import-input-container {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.import-wizard-modal .import-textarea {
    flex: 1;
    min-height: 150px;
    resize: none;
}

/* ====================================================================
   MOBILE RESPONSIVE - Import Wizard
   Full-screen takeover on mobile with proper scrolling
   ==================================================================== */

@media (max-width: 600px) {

    /* Modal: Full-screen takeover */
    .import-wizard-modal .modal-content {
        width: 100%;
        max-width: 100%;
        height: 100vh;
        height: 100dvh;
        /* Dynamic viewport for mobile browsers */
        max-height: 100vh;
        max-height: 100dvh;
        border-radius: 0;
        margin: 0;
    }

    /* Header: Compact */
    .import-wizard-header-unified {
        padding: 10px 16px;
        height: 56px;
    }

    .wizard-header-title {
        font-size: 1rem;
    }

    /* Stepper: Numbers only */
    .import-wizard-stepper.compact .wizard-step-label {
        display: none;
    }

    .import-wizard-stepper.compact .wizard-step {
        padding: 4px 10px;
    }

    /* Body: CRITICAL - Enable scrolling on mobile */
    .import-wizard-body {
        padding: 12px 16px;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
        flex: 1;
        min-height: 0;
    }

    /* Step content: Allow natural height */
    .import-wizard-modal .wizard-step-content.active {
        overflow: visible;
        min-height: auto;
    }

    /* Step 1 layout: Stack vertically */
    .step-one-layout {
        gap: 10px;
    }

    /* Drop zone: Smaller */
    .import-drop-zone {
        min-height: 100px;
        padding: 16px;
    }

    .drop-zone-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }

    .drop-zone-title {
        font-size: 0.9rem;
    }

    /* Textarea: Smaller */
    .import-input-container {
        min-height: 120px;
    }

    .import-textarea {
        min-height: 100px;
        padding: 12px 14px 44px 14px;
        font-size: 0.8rem;
    }

    /* Footer: Fixed bottom with safe-area */
    .import-wizard-footer {
        padding: 10px 16px;
        padding-bottom: max(10px, env(safe-area-inset-bottom));
        min-height: auto;
        flex-shrink: 0;
    }

    /* Step 1 Footer: Stack buttons if needed */
    .wizard-step1-footer {
        padding: 12px 0;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }

    .wizard-step1-footer .btn {
        flex: 1;
        min-width: 0;
        justify-content: center;
    }

    /* Step 2 Footer */
    .wizard-step2-footer {
        margin-top: 12px;
        padding-top: 12px;
        flex-wrap: wrap;
        gap: 10px;
    }

    /* Buttons: Touch-friendly */
    .import-wizard-footer .btn,
    .wizard-step1-footer .btn,
    .wizard-step2-footer .btn {
        min-height: 44px;
        padding: 10px 16px;
    }

    /* Mapping table: Compress */
    .import-wizard-modal .import-mapping-table-container {
        margin: 4px 0;
    }

    .import-wizard-modal .import-mapping-table th,
    .import-wizard-modal .import-mapping-table td {
        padding: 8px 6px;
        font-size: 0.75rem;
    }

    .import-wizard-modal .import-mapping-table select {
        font-size: 0.75rem;
        padding: 4px 6px;
    }

    /* === STEP 3: VERIFICATION - Mobile Redesign === */

    /* Header: Stack on mobile */
    .wizard-step3-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        margin-bottom: 12px;
        padding: 0;
    }

    .wizard-step3-header .wizard-step-title {
        font-size: 0.95rem;
    }

    .period-badge-pill {
        padding: 4px 10px;
        font-size: 0.75rem;
    }

    /* Preview Grid: Horizontal scroll with snap */
    .import-wizard-modal .import-preview-grid {
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        gap: 12px;
        padding: 8px 4px;
        margin: 0 -16px;
        padding-left: 16px;
        padding-right: 16px;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
        -ms-overflow-style: none;
        min-height: 180px;
        flex: 0 0 auto;
        /* CRITICAL: flex-start prevents left clipping when content overflows */
        justify-content: flex-start;
    }

    .import-wizard-modal .import-preview-grid::-webkit-scrollbar {
        display: none;
    }

    /* Columns: Fixed width for horizontal scroll - WIDER to prevent truncation */
    .import-wizard-modal .import-preview-col {
        flex: 0 0 85%;
        min-width: 280px;
        max-width: 320px;
        scroll-snap-align: center;
    }

    /* Column header: More compact */
    .import-wizard-modal .import-col-header {
        padding: 10px 12px;
        font-size: 0.8rem;
    }

    .import-wizard-modal .import-col-header i {
        font-size: 0.85rem;
    }

    .import-wizard-modal .import-col-count {
        padding: 2px 6px;
        font-size: 0.7rem;
    }

    /* List items: More compact */
    .import-wizard-modal .import-col-list {
        padding: 8px;
        gap: 4px;
        max-height: 120px;
    }

    .import-wizard-modal .import-col-list li {
        padding: 8px 10px;
        gap: 8px;
    }

    .import-wizard-modal .li-avatar {
        width: 22px;
        height: 22px;
        font-size: 0.6rem;
    }

    .import-wizard-modal .li-name {
        font-size: 0.75rem;
        /* Allow wrapping on mobile instead of truncating */
        white-space: normal;
        word-break: break-word;
    }

    .import-wizard-modal .empty-state-li {
        padding: 16px 12px;
        font-size: 0.75rem;
        min-height: 60px;
    }

    /* Strategy section: Vertical stack, more compact */
    .import-strategy-section {
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border-color);
    }

    .import-strategy-radio {
        padding: 10px 12px;
        gap: 10px;
    }

    .import-strategy-radio .strategy-icon {
        font-size: 1rem;
        width: 32px;
        height: 32px;
    }

    .import-strategy-radio strong {
        font-size: 0.85rem;
    }

    .import-strategy-radio .strategy-desc {
        font-size: 0.7rem;
        /* Show full text on mobile - don't truncate */
        display: block;
        line-height: 1.4;
    }

    .strategy-check {
        width: 20px;
        height: 20px;
        font-size: 0.6rem;
    }

    /* Step 3 Footer adjustments */
    #wizardStep3Footer {
        flex-direction: column;
        gap: 8px;
        padding: 12px 16px;
    }

    #wizardStep3Footer .btn {
        width: 100%;
        justify-content: center;
    }

    .step3-footer-warning {
        order: 2;
        font-size: 0.7rem;
    }

    #wizardStep3PrevBtn {
        order: 1;
    }

    #wizardImportOnlyBtn {
        order: 3;
    }

    /* "Absent du fichier" badge style for departed students */
    .import-wizard-modal .import-col-departed .li-status {
        font-size: 0.65rem;
        padding: 2px 6px;
    }
}

/* Extra small screens (375px and below) */
@media (max-width: 375px) {
    .import-wizard-header-unified {
        padding: 8px 12px;
        height: 52px;
    }

    .wizard-header-title {
        font-size: 0.9rem;
        gap: 6px;
    }

    .import-wizard-body {
        padding: 10px 12px;
    }

    .import-drop-zone {
        min-height: 80px;
    }

    .drop-zone-formats {
        gap: 4px;
    }

    /* Step 3: Even more compact */
    .import-wizard-modal .import-preview-col {
        flex: 0 0 85%;
        min-width: 200px;
        max-width: 260px;
    }

    .import-wizard-modal .import-col-list {
        max-height: 100px;
    }

    .import-strategy-radio .strategy-desc {
        -webkit-line-clamp: 1;
    }
}

/* === WARNING MESSAGE === */
.mapping-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    margin-bottom: 12px;
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: var(--radius-md);
    color: var(--warning-color);
    font-size: 0.85rem;
    font-weight: 500;
    animation: fadeIn 0.3s ease;
}

.mapping-warning i {
    font-size: 1rem;
    flex-shrink: 0;
}

/* === DUPLICATE MAPPING HIGHLIGHT === */
.mapping-select.mapping-duplicate {
    border-color: var(--warning-color) !important;
    background: rgba(245, 158, 11, 0.08) !important;
    box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
}

.mapping-select.mapping-duplicate:focus {
    border-color: var(--warning-color) !important;
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.25);
}

/* === OPTGROUP STYLING FOR MAPPING SELECTS === */
/* Visual separators for better UX in column type dropdowns */
.mapping-select optgroup {
    font-weight: 600;
    font-style: normal;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.8em;
    background: var(--bg-secondary);
    padding: 8px 0 4px 0;
}

.mapping-select optgroup option {
    font-weight: 400;
    text-transform: none;
    letter-spacing: normal;
    font-size: 0.92em;
    color: var(--text-primary);
    padding: 6px 12px;
    background: var(--bg-color);
}

/* Dark theme enhancements for optgroups */
[data-theme="dark"] .mapping-select optgroup {
    background: var(--surface-color);
    border-top: 1px solid var(--border-color);
}

[data-theme="dark"] .mapping-select optgroup option {
    background: var(--bg-color);
}