/* ====================================================================
   LISTE + FOCUS VIEW - UX Revolution
   Vue Liste pour aperçu + Vue Focus pour édition
   ==================================================================== */

/* === Vue Liste (Table) === */
.student-list-view {
    width: 100%;
    background: var(--surface-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--glass-surface-border);
    overflow: visible;
    /* Permet au menu d'actions de déborder */
    /* Espace en bas pour permettre de scroller le dernier élève au-dessus du FAB */
    margin-bottom: 80px;
}

.student-list-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.student-list-table thead {
    background: rgba(0, 0, 0, 0.02);
    border-bottom: 1px solid var(--border-color);
}

/* Coins arrondis sur le thead pour correspondre au conteneur */
.student-list-table thead tr:first-child th:first-child {
    border-top-left-radius: var(--radius-lg);
}

.student-list-table thead tr:first-child th:last-child {
    border-top-right-radius: var(--radius-lg);
}

[data-theme="dark"] .student-list-table thead {
    background: rgba(255, 255, 255, 0.03);
}

.student-list-table th {
    padding: 14px 16px;
    text-align: center;
    vertical-align: middle;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-secondary);
}

/* ====================================================================
   HEADER ACTION TRIGGER - Single Source of Truth
   Common style for interactive elements inside table headers (search, chips)
   ==================================================================== */
.header-action-trigger {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: var(--text-tertiary);
    cursor: pointer;
    border-radius: var(--radius-sm);
    opacity: 0.5;
    transition: all 0.25s cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 2;
}

.header-action-trigger:hover {
    opacity: 1 !important;
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--primary-color);
    transform: translateY(-50%) scale(1.15);
}

/* Sortable Headers */
.sortable-header {
    cursor: pointer;
    user-select: none;
    position: relative;
    transition: color 0.25s ease;
}

/* Effet de survol via pseudo-élément pour préserver le fond du thead */
.sortable-header::after {
    content: '';
    position: absolute;
    inset: 0;
    background-color: rgba(var(--primary-color-rgb), 0.06);
    opacity: 0;
    transition: opacity 0.25s ease;
    pointer-events: none;
    z-index: 0;
    border-radius: inherit;
}

.sortable-header:hover::after {
    opacity: 1;
}

.sortable-header:hover {
    color: var(--text-primary);
}

[data-theme="dark"] .sortable-header::after {
    background-color: rgba(255, 255, 255, 0.05);
}

/* Contenu au-dessus du pseudo-élément */
.sortable-header .header-content-wrapper {
    position: relative;
    z-index: 1;
}

.sortable-header.active-sort,
.sortable-header.active-sort:focus {
    color: var(--primary-color);
    background-color: transparent !important;
    outline: none;
}

/* Léger effet de survol sur la colonne triée active (indique que c'est toujours cliquable) */
.sortable-header.active-sort:hover {
    color: var(--primary-color);
    background-color: rgba(var(--primary-color-rgb), 0.04) !important;
}

[data-theme="dark"] .sortable-header.active-sort:hover {
    background-color: rgba(255, 255, 255, 0.03) !important;
}

/* Disable active-sort hover effect when hovering search button */
.name-header-with-search.active-sort:has(.inline-search-trigger-btn:hover) {
    background-color: transparent !important;
}

/* Disable pseudo-element on active-sort (we use direct background instead) */
.sortable-header.active-sort::after,
.sortable-header.active-sort:hover::after {
    opacity: 0 !important;
}

/* Header Content Alignment Wrapper - Ensures perfect centering */
.header-content-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
}

/* Sort Icon - In-flow to center the group (Text + Icon) */
.sortable-header .sort-icon-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 6px;
    min-width: 14px;
    /* Do NOT use absolute positioning - we want the group centered */
}

.sortable-header .sort-icon-placeholder iconify-icon {
    font-size: 15px;
    color: var(--primary-color);
    /* Transition for color change */
    transition: color 0.2s ease;
}

/* Hide placeholder completely when empty to ensure perfect centering of text */
.sortable-header .sort-icon-placeholder:empty {
    display: none;
    margin-left: 0;
    min-width: 0;
}

/* Ensure Name header is left-aligned */
.student-list-table th[data-sort-field="name"] {
    text-align: left;
    padding-left: 40px !important;
}

.student-list-table th[data-sort-field="name"] .header-content-wrapper {
    justify-content: flex-start;
}

.student-list-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border-color);
    vertical-align: middle;
}

.student-list-table tbody tr {
    transition: background var(--transition-fast);
    cursor: pointer;
}

.student-list-table tbody tr:hover {
    background: rgba(var(--primary-color-rgb), 0.04);
}

/* === POLISH: Show Actions on Hover (Desktop) === */
.student-list-table tbody tr .btn-action-menu {
    opacity: 0;
    transform: scale(0.9);
    transition: all 0.2s cubic-bezier(0.32, 0.72, 0, 1);
}

/* Show when row hovered */
.student-list-table tbody tr:hover .btn-action-menu,
.student-list-table tbody tr:focus-within .btn-action-menu,
.student-list-table tbody tr .btn-action-menu:focus,
.student-list-table tbody tr .action-dropdown-menu.open~.btn-action-menu,
.student-list-table tbody tr .action-dropdown:has(.action-dropdown-menu.open) .btn-action-menu {
    opacity: 1;
    transform: scale(1);
    background: white;
    /* Pop out effect */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .student-list-table tbody tr:hover .btn-action-menu {
    background: var(--surface-alert-bg);
}

/* Always visible on touch devices */
@media (hover: none) {
    .student-list-table tbody tr .btn-action-menu {
        opacity: 0.6;
        transform: scale(1);
        background: transparent;
        box-shadow: none;
    }
}

/* Active row when focus panel is open - maintains visual link */
.student-list-table tbody tr.focus-active {
    background: rgba(var(--primary-color-rgb), 0.06);
}

.student-list-table tbody tr:last-child td {
    border-bottom: none;
}

/* ====================================================================
   PREMIUM LIST FILTER ANIMATIONS
   Animations fluides iOS-style pour le filtrage de la liste
   ==================================================================== */

/* Keyframes pour l'entrée des lignes - slide up + fade */
@keyframes list-row-enter {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Animation d'entrée staggerée pour les lignes */
.student-list-table tbody tr.row-animate-in {
    animation: list-row-enter 0.3s cubic-bezier(0.32, 0.72, 0, 1) both;
    animation-delay: var(--row-delay, 0ms);
}

/* Animation de highlight subtile lors du filtrage */
@keyframes row-filter-highlight {
    0% {
        background-color: transparent;
    }

    30% {
        background-color: rgba(var(--primary-color-rgb), 0.06);
    }

    100% {
        background-color: transparent;
    }
}

.student-list-table tbody tr.filter-highlight {
    animation: row-filter-highlight 0.6s ease-out;
}

/* Keyframes pour la sortie des lignes filtrées - fade + scale + collapse */
@keyframes list-row-exit {
    0% {
        opacity: 1;
        transform: scale(1) translateX(0);
    }

    100% {
        opacity: 0;
        transform: scale(0.96) translateX(-15px);
    }
}

/* Animation de sortie pour les lignes filtrées */
.student-list-table tbody tr.row-exit {
    animation: list-row-exit 0.25s cubic-bezier(0.32, 0.72, 0, 1) forwards;
    pointer-events: none;
}

/* Classe pour les lignes qui se repositionnent (FLIP) */
.student-list-table tbody tr.row-move {
    transition: transform 0.45s cubic-bezier(0.32, 0.72, 0, 1) !important;
}

/* Effet "carte" pendant le déplacement pour un feedback visuel premium */
.student-list-table tbody tr.row-moving {
    position: relative;
    z-index: 10;
    background: var(--surface-color) !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 2px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
}

.student-list-table tbody tr.row-moving td {
    background: var(--surface-color);
}

.student-list-table tbody tr.row-moving td:first-child {
    border-radius: 8px 0 0 8px;
}

.student-list-table tbody tr.row-moving td:last-child {
    border-radius: 0 8px 8px 0;
}

[data-theme="dark"] .student-list-table tbody tr.row-moving {
    background: var(--surface-color) !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 2px 6px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .student-list-table tbody tr.row-moving td {
    background: var(--surface-color);
}

/* Keyframes pour l'entrée retardée des nouvelles lignes lors du filtrage */
@keyframes list-row-filter-enter {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.98);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.student-list-table tbody tr.row-filter-enter {
    animation: list-row-filter-enter 0.3s cubic-bezier(0.32, 0.72, 0, 1) both;
    animation-delay: var(--enter-delay, 150ms);
}

/* Student name column */
.student-name-cell {
    font-weight: 600;
    color: var(--text-primary);
    /* Prevent column jump when avatar moves above name */
    min-width: 140px;
    padding-right: 8px !important;
    transition: min-width 0.4s cubic-bezier(0.32, 0.72, 0, 1);
    /* Allow avatar zoom to overflow */
    overflow: visible;
    position: relative;
}

.student-name-cell .student-prenom {
    font-weight: 400;
    color: var(--text-secondary);
}

/* Grade columns */
.grade-cell {
    text-align: center;
    font-variant-numeric: tabular-nums;
    min-width: 60px;
}

.grade-cell .grade-value {
    font-weight: 600;
}

.grade-cell .grade-empty {
    color: var(--text-tertiary);
}

/* Grade header - compact width for T1/T2/T3 labels */
.grade-header {
    width: 70px;
    min-width: 70px;
    max-width: 80px;
    padding: 14px 8px !important;
}

/* Evolution header - direct hover effect (pseudo-element doesn't work with border-collapse) */
.evolution-header:hover {
    background-color: rgba(var(--primary-color-rgb), 0.06) !important;
}

[data-theme="dark"] .evolution-header:hover {
    background-color: rgba(255, 255, 255, 0.05) !important;
}

/* Disable pseudo-element on evolution-header */
.evolution-header::after {
    display: none;
}

/* Evolution cell styling */
.evolution-cell {
    text-align: center;
    vertical-align: middle;
}

.grade-cell .grade-evolution,
.evolution-cell .grade-evolution {
    font-size: 14px;
    font-weight: 600;
    cursor: help;
    transition: transform 0.2s ease, opacity 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    opacity: 0.9;
}

.grade-cell .grade-evolution:hover,
.evolution-cell .grade-evolution:hover {
    transform: scale(1.3);
    opacity: 1;
}

.grade-cell .grade-evolution.positive,
.evolution-cell .grade-evolution.positive {
    color: var(--success-color);
}

.grade-cell .grade-evolution.negative,
.evolution-cell .grade-evolution.negative {
    color: var(--error-color);
}

.grade-cell .grade-evolution.stable,
.evolution-cell .grade-evolution.stable {
    color: var(--text-tertiary);
    opacity: 0.6;
}

/* Appreciation/Status column */
.appreciation-cell {
    max-width: 340px;
    min-width: 280px;
    text-align: left;
    transition: padding 0.3s ease;
    position: relative;
    /* Anchor for absolute positioning */
}

/* Center status badges when no appreciation */
.appreciation-cell:has(.status-badge) {
    text-align: center;
}

.appreciation-header {
    text-align: center;
    position: relative;
}

/* Word count chip - positioned absolutely to the right */
.appreciation-header>.detail-chip {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
}

/* ====================================================================
   SMART ACTION BUTTON INLINE - Single unified button in table header
   Switches between Generate (purple) and Update (orange) modes
   ==================================================================== */
.btn-smart-action-inline {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    height: 34px;
    border-radius: var(--radius-pill);
    font-weight: 600;
    font-size: 13px;
    white-space: nowrap;
    color: white !important;
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    pointer-events: auto;
    position: relative;
    overflow: hidden;
}

/* Generate mode (default) - AI purple gradient */
.btn-smart-action-inline.mode-generate {
    background: var(--gradient-ai);
    box-shadow: 0 1px 3px rgba(var(--primary-color-rgb), 0.25);
}

.btn-smart-action-inline.mode-generate:hover {
    background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary-color) 100%);
    box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.35);
    transform: scale(1.05);
}

/* Update mode - Warning orange gradient */
.btn-smart-action-inline.mode-update {
    background: var(--gradient-warning);
    box-shadow: 0 1px 3px rgba(var(--warning-rgb), 0.25);
}

.btn-smart-action-inline.mode-update:hover {
    background: linear-gradient(135deg, var(--warning-hover) 0%, #b45309 100%);
    box-shadow: 0 2px 8px rgba(var(--warning-rgb), 0.35);
    transform: scale(1.05);
}

.btn-smart-action-inline:active {
    transform: scale(0.98);
}

/* Shine sweep for generate mode */
.btn-smart-action-inline.mode-generate::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
            transparent 0%,
            rgba(255, 255, 255, 0.4) 50%,
            transparent 100%);
    pointer-events: none;
}

.btn-smart-action-inline.mode-generate:hover::before {
    animation: shine-sweep 1.5s ease-in-out infinite;
}

.smart-action-badge {
    background: rgba(255, 255, 255, 0.3);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 700;
    min-width: 16px;
    text-align: center;
}

/* Animation d'apparition */
@keyframes inline-btn-appear {
    from {
        opacity: 0;
        transform: scale(0.8);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

.btn-smart-action-inline.animate-in {
    animation: inline-btn-appear 0.3s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

/* ====================================================================
   APPRECIATION HEADER ACTIONS CONTAINER
   ==================================================================== */
.appreciation-header-actions {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 10;
}

/* Ensure the hover overlay on appreciation header doesn't block the button */
.appreciation-header::after {
    pointer-events: none;
}

/* === FIX: Disable header hover effect when hovering interactive children === */
.appreciation-toggle-header:has(.btn-smart-action-inline:hover)::after,
.appreciation-toggle-header:has(#avgWordsChip:hover)::after,
.name-header-with-search:has(.inline-search-trigger-btn:hover)::after {
    opacity: 0 !important;
}

.appreciation-toggle-header:has(.btn-smart-action-inline:hover) .appreciation-toggle-icon,
.appreciation-toggle-header:has(#avgWordsChip:hover) .appreciation-toggle-icon {
    opacity: 0 !important;
}

/* Disable sort icon highlight when hovering search button */
.name-header-with-search:has(.inline-search-trigger-btn:hover) .sort-icon-placeholder,
.name-header-with-search:has(.inline-search-trigger-btn:hover) .name-sort-icon {
    opacity: 0 !important;
}

/* === Appreciation Column Toggle (Expand/Collapse Content) === */
/* Note: Uses .sortable-header hover effect for consistency */
.appreciation-toggle-header .header-content-wrapper {
    position: relative;
    display: inline-flex !important;
}

/* Expand Icon - appears on hover */
.appreciation-toggle-icon {
    font-size: 11px;
    opacity: 0;
    color: var(--text-tertiary);
    margin-left: 8px;
    transition: opacity 0.25s ease;
}

.appreciation-toggle-header:hover .appreciation-toggle-icon {
    opacity: 0.7;
}

.appreciation-toggle-header.expanded-view .appreciation-toggle-icon {
    opacity: 0.6;
    color: var(--primary-color);
}

/* === FULL VIEW STATE (Expanded Content) === */

/* 1. Animate cell height transition */
/* Expanded View - Width Optimization */
.student-list-table.appreciation-full-view .appreciation-cell {
    /* Control width explicitly: Wider than normal (340px) but capped */
    width: clamp(360px, 40vw, 515px);
    min-width: 360px;
    max-width: 515px;
}

/* 2. Transform the preview bubble into full content */
.student-list-table.appreciation-full-view .appreciation-preview {
    white-space: pre-wrap;
    max-height: 500px;
    overflow: visible;
    text-overflow: clip;

    /* Card-like styling for full view */
    background: rgba(0, 0, 0, 0.03);
    padding: 12px 16px;
    /* Equal horizontal padding for centered text in card */
    border-radius: var(--radius-md);
    line-height: 1.6;
    margin: 4px 0;
    border: 1px solid rgba(0, 0, 0, 0.02);
    /* Enforce left align even in full view to prevent centering issues */
    text-align: left !important;

    /* Micro-fade animation to mask white-space switch */
    animation: appreciation-expand-reveal 0.5s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

/* Shrink name column in expanded view to profit from vertical stacking */
.student-list-table.appreciation-full-view .student-name-cell {
    min-width: 230px;
    width: 230px;
}



/* Keyframe: subtle blur-to-sharp fade masks the instant white-space change */
@keyframes appreciation-expand-reveal {
    0% {
        opacity: 0.4;
        filter: blur(2px);
    }

    100% {
        opacity: 1;
        filter: blur(0);
    }
}

[data-theme="dark"] .student-list-table.appreciation-full-view .appreciation-preview {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
}


/* Appreciation Preview - Truncated inline display */
.appreciation-preview {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 13px;
    line-height: 1.5;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.02);
    max-width: 100%;
    max-height: 32px;

    /* iOS Spring transitions synced with row animation */
    transition:
        max-height 0.5s cubic-bezier(0.32, 0.72, 0, 1),
        padding 0.4s cubic-bezier(0.32, 0.72, 0, 1),
        background 0.4s cubic-bezier(0.32, 0.72, 0, 1),
        line-height 0.4s cubic-bezier(0.32, 0.72, 0, 1),
        border-radius 0.4s cubic-bezier(0.32, 0.72, 0, 1),
        transform 0.3s cubic-bezier(0.32, 0.72, 0, 1),
        /* Added for smooth zoom */
        box-shadow 0.3s ease,
        /* Added for smooth shadow lift */
        opacity 0.15s ease;

    /* Slight fade during collapse to mask white-space switch */
    opacity: 1;
}

/* Expanded state during generation - smooth transition */
.appreciation-preview.expanded {
    white-space: pre-wrap;
    max-height: 300px;
    /* Allow multi-line */
}

[data-theme="dark"] .appreciation-preview {
    background: rgba(255, 255, 255, 0.04);
}


.appreciation-preview:hover {
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--text-primary);
    /* No zoom in compact view as requested */
}

/* Harmonization: Apply hover effect to expanded view with enhanced zoom */
.student-list-table.appreciation-full-view .appreciation-preview:hover {
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--text-primary);
    /* Maintain the card shape while scaling - INCREASED ZOOM (5% boost) */
    transform: scale(1.05);
    /* Flat design - no shadow */
    box-shadow: none;
}

/* Subtle indicator removed - JS handles truncation with "..." */

/* Status badges (shown when no appreciation) */
.appreciation-cell .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: var(--radius-pill);
    font-size: 12px;
    font-weight: 500;
}

.status-badge.done {
    background: rgba(var(--success-rgb, 16, 185, 129), 0.1);
    color: var(--success-color);
}

.status-badge.pending {
    background: rgba(0, 0, 0, 0.06);
    color: var(--text-secondary);
}

[data-theme="dark"] .status-badge.pending {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
}

.status-badge.error {
    background: rgba(var(--error-rgb, 239, 68, 68), 0.1);
    color: var(--error-color);
}



/* Status Column */
.status-cell {
    text-align: center;
    vertical-align: middle;
    width: 120px;
    padding: 8px 4px !important;
}

.status-cell .status-badge {
    /* Reuse existing badge appearance but ensure centered */
    margin: 0 auto;
    width: fit-content;
}

/* Action column */
.action-cell {
    text-align: center;
    position: relative;
}

.action-cell .btn {
    padding: 6px 12px;
    font-size: 12px;
}

/* === 3-Dot Action Dropdown === */
.action-dropdown {
    position: relative;
    display: inline-flex;
}

.btn-action-menu {
    width: 32px;
    height: 32px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast), opacity 0.2s ease;
    /* Hidden by default - appears on row hover (iOS 2025 pattern) */
    opacity: 0;
}

/* Reveal on row hover or when menu is open */
.student-list-table tbody tr:hover .btn-action-menu,
.action-dropdown.open .btn-action-menu {
    opacity: 1;
}

.btn-action-menu:hover {
    background: rgba(var(--primary-color-rgb), 0.1) !important;
    color: var(--primary-color);
}

.action-dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    min-width: 160px;
    background: var(--surface-color);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateY(-8px) scale(0.95);
    transition: opacity 0.2s cubic-bezier(0.32, 0.72, 0, 1),
        visibility 0.2s cubic-bezier(0.32, 0.72, 0, 1),
        transform 0.2s cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 100;
    overflow: hidden;
    padding: 6px;
    /* Harmonisé avec le menu global */
}

.action-dropdown-menu.open {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

.action-dropdown-item {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 10px 12px;
    /* Harmonisé avec le menu global */
    border: none;
    background: transparent;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: left;
    border-radius: 8px;
    /* Harmonisé avec le menu global */
}

.action-dropdown-item:hover {
    background: rgba(var(--primary-color-rgb), 0.08);
    color: var(--primary-color);
}

.action-dropdown-item i {
    width: 16px;
    text-align: center;
    opacity: 0.7;
}

.action-dropdown-item.danger {
    color: var(--error-color);
}

.action-dropdown-item.danger:hover {
    background: rgba(var(--error-rgb), 0.1);
    color: var(--error-color);
}

[data-theme="dark"] .action-dropdown-menu {
    background: rgba(17, 24, 39, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
}

/* === GLOBAL ACTIONS DROPDOWN (Table Header) === */
/* Réutilise .action-dropdown-menu et .action-dropdown-item - source unique de vérité */
.global-actions-dropdown {
    position: relative;
    display: flex;
    justify-content: center;
}

.btn-action-menu-header {
    width: 32px;
    height: 32px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    box-shadow: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    opacity: 0.6;
}

.btn-action-menu-header:hover {
    background: rgba(var(--primary-color-rgb), 0.1);
    color: var(--primary-color);
    opacity: 1;
    transform: scale(1.1);
}

/* Le menu global hérite de .action-dropdown-menu + surcharges spécifiques */
.global-actions-dropdown-menu {
    /* Override: hérite de action-dropdown-menu mais avec ces différences */
    position: absolute;
    top: 100%;
    /* S'ouvre vers le BAS */
    right: 0;
    /* Le menu est décalé vers la gauche via translateX pour éviter le débordement */
    margin-top: 8px;
    min-width: 220px;
    /* Plus large que le menu individuel */
    background: var(--surface-color);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    display: block;
    /* Ensure block layout but invisible */
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateX(-20px) translateY(-8px) scale(0.95);
    transition: opacity 0.2s cubic-bezier(0.32, 0.72, 0, 1),
        visibility 0.2s cubic-bezier(0.32, 0.72, 0, 1),
        transform 0.2s cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 200;
    /* Plus élevé que le menu individuel (100) */
    overflow: hidden;
    padding: 6px;
}

.global-actions-dropdown-menu.open {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(-20px) translateY(0) scale(1);
}

/* === Headers sectionnels (Partagé global + individuel) === */
.global-actions-dropdown-menu .dropdown-header,
.action-dropdown-menu .dropdown-header {
    margin: 0;
    padding: 8px 12px 6px;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 6px;
    border-top: 1px solid var(--border-color);
}

.global-actions-dropdown-menu .dropdown-header:first-of-type,
.action-dropdown-menu .dropdown-header:first-of-type {
    border-top: none;
    padding-top: 4px;
}

.global-actions-dropdown-menu .dropdown-header i,
.action-dropdown-menu .dropdown-header i {
    font-size: 10px;
    opacity: 0.6;
}

/* Divider danger (spécifique au menu global) */
.global-actions-dropdown-menu .dropdown-divider.danger-divider,
.action-dropdown-menu .dropdown-divider {
    border-top: 1px solid rgba(var(--error-rgb), 0.2);
    margin: 4px 8px;
}

[data-theme="dark"] .global-actions-dropdown-menu,
[data-theme="dark"] .action-dropdown-menu {
    background: rgba(17, 24, 39, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
}

/* ====================================================================
   MOBILE RESPONSIVE (CARD LAYOUT) - iOS 2026 Style
   ==================================================================== */
@media (max-width: 768px) {
    .student-list-view {
        background: transparent;
        border: none;
        box-shadow: none;
        margin-bottom: 24px;
        overflow: visible;
    }

    .student-list-table,
    .student-list-table tbody,
    .student-list-table tr,
    .student-list-table th,
    .student-list-table td {
        display: block;
        width: 100%;
        box-sizing: border-box !important;
    }

    /* --- THEAD (Header & Toolbars) --- */
    .student-list-table thead {
        display: flex;
        background: transparent !important;
        border: none;
        margin-bottom: 12px;
    }

    [data-theme="dark"] .student-list-table thead {
        background: transparent !important;
    }

    .student-list-table thead tr {
        display: flex;
        flex-wrap: nowrap !important;
        /* Forces elements to stay on a single line, delegating wrapping to children */
        gap: 10px;
        /* Synchronized with internal button gaps */
        align-items: flex-start;
        /* Ensures top alignment when children wrap internally */
        background: var(--surface-color);
        padding: 16px;
        /* Increased from 12px for breathing room */
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        /* Retirer l'effet de hover natif des thead sur mobile */
        pointer-events: auto;
        position: relative;
        /* important pour la barre de recherche */
        width: 100%;
        box-sizing: border-box !important;
    }

    [data-theme="dark"] .student-list-table thead tr {
        background: var(--surface-color);
    }

    /* Hide standard headers */
    .student-list-table th {
        display: none !important;
        padding: 0 !important;
        border: none !important;
    }

    /* Masquer le texte "Nom", "Statut", "Appréciation" */
    .student-list-table th .header-content-wrapper {
        display: none !important;
    }

    /* Keep Search, Actions, and Global Menu visible */
    .student-list-table th.name-header-with-search,
    .student-list-table th.appreciation-toggle-header,
    .student-list-table th.action-header {
        display: flex !important;
        align-items: center;
        gap: 14px;
        width: auto !important;
        pointer-events: none !important;
        /* Empêche le clic dans les espaces vides de déclencher le tri */
    }

    /* Réactive les clics pour les vrais boutons */
    .inline-search-trigger-btn,
    .inline-search-container,
    .appreciation-header-actions,
    #avgWordsChip,
    .global-actions-dropdown {
        pointer-events: auto !important;
    }

    /* Make search button visible as an action button */
    .student-list-table th.name-header-with-search {
        flex: 0 0 40px !important;
        /* REDUCED to match orange button height */
        order: 1;
        width: 40px !important;
        /* REDUCED */
        min-width: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        position: static !important;
        justify-content: flex-start;
    }

    .inline-search-trigger-btn {
        position: static !important;
        transform: none !important;
        width: 40px;
        /* REDUCED to match others */
        height: 40px;
        /* REDUCED */
        border-radius: var(--radius-md);
        background: rgba(0, 0, 0, 0.04);
        display: flex !important;
        align-items: center;
        justify-content: center;
        opacity: 1 !important;
        color: var(--text-secondary) !important;
        /* MATCH THE TOGGLE BTN TEXT COLOR */
    }

    [data-theme="dark"] .inline-search-trigger-btn {
        background: rgba(255, 255, 255, 0.05);
    }

    /* Actions line (Generate, Update) */
    .student-list-table th.appreciation-toggle-header {
        flex: 1 1 0% !important;
        /* FORCE shrink so we don't wrap the entire TH */
        min-width: 0 !important;
        order: 2;
        /* Standard flow: Actions on the left (next to Search), Word chip pushed to the right */
        flex-direction: row !important;
        justify-content: flex-start;
        flex-wrap: wrap;
        /* allows chip to overflow below if strictly needed */
        align-content: center;
        gap: 10px;
        /* Synchronized with global row gaps */
        position: relative;
    }

    /* Remet le pill de mots dans la logique Flex en deuxième position */
    #avgWordsChip {
        position: static !important;
        transform: none !important;
        order: 2;
        /* Rendered after actions */
        margin: 0 0 0 auto !important;
        /* Pushes it to the extreme right */
        right: auto !important;
        left: auto !important;
        top: auto !important;
        opacity: 1 !important;
        /* Full Chip Styling */
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.04) !important;
        color: var(--text-secondary) !important;
        padding: 0 14px !important;
        /* Managed by exact height center alignment */
        height: 40px !important;
        /* EXACTLY match other buttons height */
        box-sizing: border-box !important;
        border-radius: var(--radius-pill) !important;
        font-weight: 500 !important;
    }

    [data-theme="dark"] #avgWordsChip {
        background: rgba(255, 255, 255, 0.05) !important;
    }

    .appreciation-header-actions {
        position: static !important;
        transform: none !important;
        display: flex;
        gap: 10px;
        flex-wrap: nowrap;
        /* Keep actions inline together */
        align-items: center;
        order: 1;
        /* First rendered, which is top-right in row-reverse */
        margin-left: 0 !important;
        /* Reset margin */
    }

    /* Bouton pour basculer la vue (compact/étendu) */
    #mobileCompactToggleBtn {
        position: static !important;
        transform: none !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        width: 40px;
        /* REDUCED to match others */
        height: 40px;
        /* REDUCED */
        border-radius: var(--radius-md);
        background: rgba(0, 0, 0, 0.04);
        border: none;
        color: var(--text-secondary);
        font-size: 1.2rem;
        transition: all var(--transition-fast);
        pointer-events: auto !important;
        opacity: 1 !important;
        /* FIX: Restores original color without 50% tint inherited from .header-action-trigger */
    }

    [data-theme="dark"] #mobileCompactToggleBtn {
        background: rgba(255, 255, 255, 0.05);
    }

    #mobileCompactToggleBtn:active {
        background: rgba(var(--primary-color-rgb), 0.1);
        color: var(--primary-color);
        transform: scale(0.95);
    }

    /* Global Menu */
    .student-list-table th.action-header {
        flex: 0 0 auto;
        order: 3;
    }

    .global-actions-dropdown .btn-action-menu-header {
        background: rgba(0, 0, 0, 0.04);
        border-radius: var(--radius-md);
        width: 40px;
        /* REDUCED to match others */
        height: 40px;
        /* REDUCED */
    }

    [data-theme="dark"] .global-actions-dropdown .btn-action-menu-header {
        background: rgba(255, 255, 255, 0.05);
    }

    /* Décalage du dropdown pour qu'il reste à l'écran */
    .global-actions-dropdown-menu {
        right: 0;
        left: auto;
        transform: translateY(8px) scale(0.95);
    }

    .global-actions-dropdown-menu.open {
        transform: translateY(0) scale(1);
    }

    /* --- TBODY (Student Cards) --- */
    .student-list-table tbody tr {
        background: var(--surface-color);
        border-radius: var(--radius-lg);
        margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--border-color);
        padding: 16px;
        position: relative;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        transition: transform 0.25s cubic-bezier(0.32, 0.72, 0, 1), box-shadow 0.25s cubic-bezier(0.32, 0.72, 0, 1);
    }

    [data-theme="dark"] .student-list-table tbody tr {
        background: var(--surface-color);
        border-color: rgba(255, 255, 255, 0.05);
    }

    .student-list-table tbody tr:active {
        transform: scale(0.98);
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .student-list-table td {
        border-bottom: none !important;
        padding: 0 !important;
    }

    /* 1. Identity (Top) */
    .student-name-cell {
        margin-bottom: 12px;
        padding-right: 48px !important;
        /* Espace pour l'action cell à droite */
        padding-bottom: 12px !important;
        width: 100% !important;
    }

    [data-theme="dark"] .student-name-cell {
        border-bottom-color: rgba(255, 255, 255, 0.05);
    }

    .student-identity-wrapper {
        gap: 12px;
    }

    .student-nom-prenom {
        font-size: 1.1rem;
    }

    .student-avatar {
        width: 44px;
        height: 44px;
        font-size: 1rem;
    }

    /* 2. Status Badge (Inline below name) */
    .status-cell {
        position: static;
        flex: 0 0 auto !important;
        width: auto !important;
        margin-right: 12px;
        margin-bottom: 12px;
        display: flex !important;
        align-items: center;
    }

    /* 3. Grades (Middle Row) */
    .student-list-table td.grade-cell,
    .student-list-table td.evolution-cell {
        flex: 0 0 auto !important;
        width: auto !important;
        margin-bottom: 12px;
        display: flex !important;
        align-items: center;
    }

    .grade-cell {
        margin-right: 4px;
        font-size: 0.95em;
        background: transparent !important;
        padding: 0 !important;
    }

    .evolution-cell {
        margin-right: 12px;
    }

    .grade-cell .grade-evolution,
    .evolution-cell .grade-evolution {
        margin: 0 4px;
    }


    /* 4. Appreciation (Bottom) */
    .appreciation-cell {
        margin-top: 4px;
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
    }

    .appreciation-preview {
        box-sizing: border-box !important;
        width: 100% !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-height: 48px !important;
        background: rgba(0, 0, 0, 0.02);
        padding: 14px;
        border-radius: var(--radius-md);
        border: 1px solid rgba(0, 0, 0, 0.02);
        font-size: 14px;
        line-height: 1.6;
    }

    .student-list-table.appreciation-full-view .appreciation-preview {
        white-space: pre-wrap !important;
        max-height: none !important;
        overflow: visible !important;
    }

    [data-theme="dark"] .appreciation-preview {
        background: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.02);
    }

    .student-list-table.appreciation-full-view .appreciation-cell {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
    }

    /* 5. Action Cell (Absolute Top Right over name cell) */
    .action-cell {
        position: absolute;
        top: 16px;
        right: 16px;
        width: auto !important;
    }

    /* Show action buttons clearly on mobile - but keep them minimalist */
    .btn-action-menu {
        opacity: 0.7 !important;
        background: transparent !important;
        box-shadow: none !important;
        transform: none !important;
        width: 44px;
        /* Touch target minimum size */
        height: 44px;
        border: none !important;
        color: var(--text-tertiary);
    }

    [data-theme="dark"] .btn-action-menu {
        background: transparent !important;
    }

    .btn-action-menu:active {
        box-shadow: none !important;
        background: rgba(var(--primary-color-rgb), 0.1) !important;
        color: var(--primary-color);
        transform: scale(0.95) !important;
        opacity: 1 !important;
    }
}